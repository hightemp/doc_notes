<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Obsidian notes</title>
    <meta name="generator" content="VuePress 1.9.9">
    
    <meta name="description" content="Obsidian notes">
    <meta name="theme-color" content="#3eaf7c">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    
    <link rel="preload" href="/doc_notes/assets/css/0.styles.60b82a90.css" as="style"><link rel="preload" href="/doc_notes/assets/js/app.d7b7570d.js" as="script"><link rel="preload" href="/doc_notes/assets/js/2.733019b2.js" as="script"><link rel="preload" href="/doc_notes/assets/js/142.266c8a69.js" as="script"><link rel="prefetch" href="/doc_notes/assets/js/10.466a3961.js"><link rel="prefetch" href="/doc_notes/assets/js/100.eed12daa.js"><link rel="prefetch" href="/doc_notes/assets/js/101.c2c72797.js"><link rel="prefetch" href="/doc_notes/assets/js/102.3a5b3674.js"><link rel="prefetch" href="/doc_notes/assets/js/103.4df54047.js"><link rel="prefetch" href="/doc_notes/assets/js/104.4e3d031e.js"><link rel="prefetch" href="/doc_notes/assets/js/105.fb56ad64.js"><link rel="prefetch" href="/doc_notes/assets/js/106.4cd1492c.js"><link rel="prefetch" href="/doc_notes/assets/js/107.a916259a.js"><link rel="prefetch" href="/doc_notes/assets/js/108.dfbcdb35.js"><link rel="prefetch" href="/doc_notes/assets/js/109.b85d5957.js"><link rel="prefetch" href="/doc_notes/assets/js/11.70fc3590.js"><link rel="prefetch" href="/doc_notes/assets/js/110.dc40183f.js"><link rel="prefetch" href="/doc_notes/assets/js/111.a9f83101.js"><link rel="prefetch" href="/doc_notes/assets/js/112.1b402c16.js"><link rel="prefetch" href="/doc_notes/assets/js/113.89928947.js"><link rel="prefetch" href="/doc_notes/assets/js/114.8be0db96.js"><link rel="prefetch" href="/doc_notes/assets/js/115.bd9e24bd.js"><link rel="prefetch" href="/doc_notes/assets/js/116.1979db39.js"><link rel="prefetch" href="/doc_notes/assets/js/117.7a439523.js"><link rel="prefetch" href="/doc_notes/assets/js/118.680aed03.js"><link rel="prefetch" href="/doc_notes/assets/js/119.dfdba03a.js"><link rel="prefetch" href="/doc_notes/assets/js/12.0f945969.js"><link rel="prefetch" href="/doc_notes/assets/js/120.37c405a9.js"><link rel="prefetch" href="/doc_notes/assets/js/121.672a368b.js"><link rel="prefetch" href="/doc_notes/assets/js/122.f1b5fad1.js"><link rel="prefetch" href="/doc_notes/assets/js/123.b0d4c3db.js"><link rel="prefetch" href="/doc_notes/assets/js/124.7f08733e.js"><link rel="prefetch" href="/doc_notes/assets/js/125.619db48f.js"><link rel="prefetch" href="/doc_notes/assets/js/126.048ed0c7.js"><link rel="prefetch" href="/doc_notes/assets/js/127.cc65fb73.js"><link rel="prefetch" href="/doc_notes/assets/js/128.27591c7f.js"><link rel="prefetch" href="/doc_notes/assets/js/129.e848d5ea.js"><link rel="prefetch" href="/doc_notes/assets/js/13.353aee93.js"><link rel="prefetch" href="/doc_notes/assets/js/130.0b6325e2.js"><link rel="prefetch" href="/doc_notes/assets/js/131.a4a8dc74.js"><link rel="prefetch" href="/doc_notes/assets/js/132.f78488ea.js"><link rel="prefetch" href="/doc_notes/assets/js/133.2c57ab36.js"><link rel="prefetch" href="/doc_notes/assets/js/134.c041a644.js"><link rel="prefetch" href="/doc_notes/assets/js/135.dd89210d.js"><link rel="prefetch" href="/doc_notes/assets/js/136.127b0247.js"><link rel="prefetch" href="/doc_notes/assets/js/137.1ff783eb.js"><link rel="prefetch" href="/doc_notes/assets/js/138.e72eaf60.js"><link rel="prefetch" href="/doc_notes/assets/js/139.135c74d8.js"><link rel="prefetch" href="/doc_notes/assets/js/14.a3283f94.js"><link rel="prefetch" href="/doc_notes/assets/js/140.4a7f191d.js"><link rel="prefetch" href="/doc_notes/assets/js/141.fa563aa9.js"><link rel="prefetch" href="/doc_notes/assets/js/143.3c3e596e.js"><link rel="prefetch" href="/doc_notes/assets/js/144.46a5cdc6.js"><link rel="prefetch" href="/doc_notes/assets/js/145.c33d2f51.js"><link rel="prefetch" href="/doc_notes/assets/js/146.ecf9ffa3.js"><link rel="prefetch" href="/doc_notes/assets/js/147.ecc8f162.js"><link rel="prefetch" href="/doc_notes/assets/js/148.57a0cc2c.js"><link rel="prefetch" href="/doc_notes/assets/js/149.243334a6.js"><link rel="prefetch" href="/doc_notes/assets/js/15.c66e3407.js"><link rel="prefetch" href="/doc_notes/assets/js/150.6811595e.js"><link rel="prefetch" href="/doc_notes/assets/js/151.a1b33f48.js"><link rel="prefetch" href="/doc_notes/assets/js/152.754c44e2.js"><link rel="prefetch" href="/doc_notes/assets/js/153.b6b30dd0.js"><link rel="prefetch" href="/doc_notes/assets/js/154.78d410b8.js"><link rel="prefetch" href="/doc_notes/assets/js/155.767f3fb1.js"><link rel="prefetch" href="/doc_notes/assets/js/156.f9095760.js"><link rel="prefetch" href="/doc_notes/assets/js/157.c538a726.js"><link rel="prefetch" href="/doc_notes/assets/js/158.9835a2a3.js"><link rel="prefetch" href="/doc_notes/assets/js/159.9d7c5a05.js"><link rel="prefetch" href="/doc_notes/assets/js/16.e7ecc933.js"><link rel="prefetch" href="/doc_notes/assets/js/160.addf636e.js"><link rel="prefetch" href="/doc_notes/assets/js/161.b9499ae3.js"><link rel="prefetch" href="/doc_notes/assets/js/162.9ebe738a.js"><link rel="prefetch" href="/doc_notes/assets/js/163.4860d1e7.js"><link rel="prefetch" href="/doc_notes/assets/js/164.148cebf3.js"><link rel="prefetch" href="/doc_notes/assets/js/165.41046f67.js"><link rel="prefetch" href="/doc_notes/assets/js/166.6deaed29.js"><link rel="prefetch" href="/doc_notes/assets/js/167.6d02a205.js"><link rel="prefetch" href="/doc_notes/assets/js/168.c86d38a7.js"><link rel="prefetch" href="/doc_notes/assets/js/169.eb313225.js"><link rel="prefetch" href="/doc_notes/assets/js/17.65a71bb5.js"><link rel="prefetch" href="/doc_notes/assets/js/170.889855cd.js"><link rel="prefetch" href="/doc_notes/assets/js/171.b95cf306.js"><link rel="prefetch" href="/doc_notes/assets/js/172.0b1e5fe3.js"><link rel="prefetch" href="/doc_notes/assets/js/173.99679181.js"><link rel="prefetch" href="/doc_notes/assets/js/174.f28ad52f.js"><link rel="prefetch" href="/doc_notes/assets/js/175.1c1f371e.js"><link rel="prefetch" href="/doc_notes/assets/js/176.662a9d28.js"><link rel="prefetch" href="/doc_notes/assets/js/177.6e464bd5.js"><link rel="prefetch" href="/doc_notes/assets/js/178.102c88e4.js"><link rel="prefetch" href="/doc_notes/assets/js/179.dddab088.js"><link rel="prefetch" href="/doc_notes/assets/js/18.8fedcbac.js"><link rel="prefetch" href="/doc_notes/assets/js/180.345e741e.js"><link rel="prefetch" href="/doc_notes/assets/js/181.59db7110.js"><link rel="prefetch" href="/doc_notes/assets/js/182.7f628252.js"><link rel="prefetch" href="/doc_notes/assets/js/183.e8653839.js"><link rel="prefetch" href="/doc_notes/assets/js/184.3eec36ec.js"><link rel="prefetch" href="/doc_notes/assets/js/185.cb0c13d5.js"><link rel="prefetch" href="/doc_notes/assets/js/186.1ccbe1a2.js"><link rel="prefetch" href="/doc_notes/assets/js/187.55e6bc99.js"><link rel="prefetch" href="/doc_notes/assets/js/188.1829998b.js"><link rel="prefetch" href="/doc_notes/assets/js/189.e86e8099.js"><link rel="prefetch" href="/doc_notes/assets/js/19.8fd4f833.js"><link rel="prefetch" href="/doc_notes/assets/js/190.3263ca68.js"><link rel="prefetch" href="/doc_notes/assets/js/191.6973d93a.js"><link rel="prefetch" href="/doc_notes/assets/js/192.8c648d4c.js"><link rel="prefetch" href="/doc_notes/assets/js/193.135dc6c4.js"><link rel="prefetch" href="/doc_notes/assets/js/194.2387809d.js"><link rel="prefetch" href="/doc_notes/assets/js/195.4e094a48.js"><link rel="prefetch" href="/doc_notes/assets/js/196.faae151e.js"><link rel="prefetch" href="/doc_notes/assets/js/197.6ca84b2f.js"><link rel="prefetch" href="/doc_notes/assets/js/198.99d5a7c7.js"><link rel="prefetch" href="/doc_notes/assets/js/199.5ac6f260.js"><link rel="prefetch" href="/doc_notes/assets/js/20.b7871733.js"><link rel="prefetch" href="/doc_notes/assets/js/200.434715d2.js"><link rel="prefetch" href="/doc_notes/assets/js/201.df5e4553.js"><link rel="prefetch" href="/doc_notes/assets/js/202.4f5738c7.js"><link rel="prefetch" href="/doc_notes/assets/js/203.7bdee8f2.js"><link rel="prefetch" href="/doc_notes/assets/js/204.5b4e69e3.js"><link rel="prefetch" href="/doc_notes/assets/js/205.58586a6e.js"><link rel="prefetch" href="/doc_notes/assets/js/206.b5603313.js"><link rel="prefetch" href="/doc_notes/assets/js/207.e1a4577a.js"><link rel="prefetch" href="/doc_notes/assets/js/208.2369d699.js"><link rel="prefetch" href="/doc_notes/assets/js/209.baadeea1.js"><link rel="prefetch" href="/doc_notes/assets/js/21.1cff06fb.js"><link rel="prefetch" href="/doc_notes/assets/js/210.2b107173.js"><link rel="prefetch" href="/doc_notes/assets/js/211.c8eea835.js"><link rel="prefetch" href="/doc_notes/assets/js/212.1fae6417.js"><link rel="prefetch" href="/doc_notes/assets/js/213.5696d97f.js"><link rel="prefetch" href="/doc_notes/assets/js/214.bbd783da.js"><link rel="prefetch" href="/doc_notes/assets/js/215.1c0c350c.js"><link rel="prefetch" href="/doc_notes/assets/js/216.498044dc.js"><link rel="prefetch" href="/doc_notes/assets/js/217.319f81c6.js"><link rel="prefetch" href="/doc_notes/assets/js/218.8911d413.js"><link rel="prefetch" href="/doc_notes/assets/js/219.f37e96ea.js"><link rel="prefetch" href="/doc_notes/assets/js/22.2cd72a62.js"><link rel="prefetch" href="/doc_notes/assets/js/220.b5ac8e75.js"><link rel="prefetch" href="/doc_notes/assets/js/221.cde91cfa.js"><link rel="prefetch" href="/doc_notes/assets/js/222.df059246.js"><link rel="prefetch" href="/doc_notes/assets/js/223.3ce433b3.js"><link rel="prefetch" href="/doc_notes/assets/js/224.36f2c1ff.js"><link rel="prefetch" href="/doc_notes/assets/js/225.fbee00f9.js"><link rel="prefetch" href="/doc_notes/assets/js/226.306f0e70.js"><link rel="prefetch" href="/doc_notes/assets/js/227.4e7373a0.js"><link rel="prefetch" href="/doc_notes/assets/js/228.44fd0171.js"><link rel="prefetch" href="/doc_notes/assets/js/229.f832a1d6.js"><link rel="prefetch" href="/doc_notes/assets/js/23.e9957abc.js"><link rel="prefetch" href="/doc_notes/assets/js/230.043a91e9.js"><link rel="prefetch" href="/doc_notes/assets/js/231.7616cdd1.js"><link rel="prefetch" href="/doc_notes/assets/js/232.c3eb262d.js"><link rel="prefetch" href="/doc_notes/assets/js/233.645ff598.js"><link rel="prefetch" href="/doc_notes/assets/js/234.bb763bdf.js"><link rel="prefetch" href="/doc_notes/assets/js/235.f6724c17.js"><link rel="prefetch" href="/doc_notes/assets/js/236.2fe5969c.js"><link rel="prefetch" href="/doc_notes/assets/js/237.c379ae13.js"><link rel="prefetch" href="/doc_notes/assets/js/238.bc474d07.js"><link rel="prefetch" href="/doc_notes/assets/js/239.b4b3094b.js"><link rel="prefetch" href="/doc_notes/assets/js/24.e4e0f07a.js"><link rel="prefetch" href="/doc_notes/assets/js/240.b7298fad.js"><link rel="prefetch" href="/doc_notes/assets/js/241.edc191c3.js"><link rel="prefetch" href="/doc_notes/assets/js/242.d79274ed.js"><link rel="prefetch" href="/doc_notes/assets/js/243.db97328a.js"><link rel="prefetch" href="/doc_notes/assets/js/244.68cd4704.js"><link rel="prefetch" href="/doc_notes/assets/js/245.f501295b.js"><link rel="prefetch" href="/doc_notes/assets/js/246.ddc4d5d9.js"><link rel="prefetch" href="/doc_notes/assets/js/247.ff22cc5b.js"><link rel="prefetch" href="/doc_notes/assets/js/248.4a61cd51.js"><link rel="prefetch" href="/doc_notes/assets/js/249.be49f5ca.js"><link rel="prefetch" href="/doc_notes/assets/js/25.c7ae079a.js"><link rel="prefetch" href="/doc_notes/assets/js/250.43caa09e.js"><link rel="prefetch" href="/doc_notes/assets/js/251.26d5a6e9.js"><link rel="prefetch" href="/doc_notes/assets/js/252.b3bcf0c8.js"><link rel="prefetch" href="/doc_notes/assets/js/253.1a1b2b11.js"><link rel="prefetch" href="/doc_notes/assets/js/254.1c4090ef.js"><link rel="prefetch" href="/doc_notes/assets/js/255.a49e9f41.js"><link rel="prefetch" href="/doc_notes/assets/js/256.78de4e85.js"><link rel="prefetch" href="/doc_notes/assets/js/257.3f3d8408.js"><link rel="prefetch" href="/doc_notes/assets/js/258.2a59b276.js"><link rel="prefetch" href="/doc_notes/assets/js/259.8916e4fc.js"><link rel="prefetch" href="/doc_notes/assets/js/26.1ae4ceb3.js"><link rel="prefetch" href="/doc_notes/assets/js/260.9e38f578.js"><link rel="prefetch" href="/doc_notes/assets/js/261.bb658a8a.js"><link rel="prefetch" href="/doc_notes/assets/js/262.e3dc3020.js"><link rel="prefetch" href="/doc_notes/assets/js/263.f1020a9b.js"><link rel="prefetch" href="/doc_notes/assets/js/264.b8f1ff3a.js"><link rel="prefetch" href="/doc_notes/assets/js/265.d3eb13d8.js"><link rel="prefetch" href="/doc_notes/assets/js/266.f27ca21b.js"><link rel="prefetch" href="/doc_notes/assets/js/267.338c834f.js"><link rel="prefetch" href="/doc_notes/assets/js/268.b9ebda2b.js"><link rel="prefetch" href="/doc_notes/assets/js/269.dc7525cf.js"><link rel="prefetch" href="/doc_notes/assets/js/27.42caa565.js"><link rel="prefetch" href="/doc_notes/assets/js/270.137ed51c.js"><link rel="prefetch" href="/doc_notes/assets/js/271.b6fdb998.js"><link rel="prefetch" href="/doc_notes/assets/js/272.ddc1ee03.js"><link rel="prefetch" href="/doc_notes/assets/js/273.df6133aa.js"><link rel="prefetch" href="/doc_notes/assets/js/274.9115305d.js"><link rel="prefetch" href="/doc_notes/assets/js/275.13342d76.js"><link rel="prefetch" href="/doc_notes/assets/js/276.a9e1f1ec.js"><link rel="prefetch" href="/doc_notes/assets/js/277.f2728f30.js"><link rel="prefetch" href="/doc_notes/assets/js/278.7e726870.js"><link rel="prefetch" href="/doc_notes/assets/js/279.648ad6bd.js"><link rel="prefetch" href="/doc_notes/assets/js/28.45f1bbb9.js"><link rel="prefetch" href="/doc_notes/assets/js/280.720a2918.js"><link rel="prefetch" href="/doc_notes/assets/js/281.5a2d475b.js"><link rel="prefetch" href="/doc_notes/assets/js/282.62bc635b.js"><link rel="prefetch" href="/doc_notes/assets/js/283.ff6be5f5.js"><link rel="prefetch" href="/doc_notes/assets/js/284.3f7c0af1.js"><link rel="prefetch" href="/doc_notes/assets/js/285.c2f51624.js"><link rel="prefetch" href="/doc_notes/assets/js/286.a5b99138.js"><link rel="prefetch" href="/doc_notes/assets/js/287.829ac9bd.js"><link rel="prefetch" href="/doc_notes/assets/js/288.54aabaae.js"><link rel="prefetch" href="/doc_notes/assets/js/289.71b4d090.js"><link rel="prefetch" href="/doc_notes/assets/js/29.0fdf0aa1.js"><link rel="prefetch" href="/doc_notes/assets/js/290.df175e90.js"><link rel="prefetch" href="/doc_notes/assets/js/291.014245fe.js"><link rel="prefetch" href="/doc_notes/assets/js/292.8d375ce2.js"><link rel="prefetch" href="/doc_notes/assets/js/293.8591ceba.js"><link rel="prefetch" href="/doc_notes/assets/js/294.d979d20b.js"><link rel="prefetch" href="/doc_notes/assets/js/295.372c2d39.js"><link rel="prefetch" href="/doc_notes/assets/js/296.07d572ab.js"><link rel="prefetch" href="/doc_notes/assets/js/297.5de1073e.js"><link rel="prefetch" href="/doc_notes/assets/js/298.5a6ac1ca.js"><link rel="prefetch" href="/doc_notes/assets/js/299.e87a7ab3.js"><link rel="prefetch" href="/doc_notes/assets/js/3.8087b6c9.js"><link rel="prefetch" href="/doc_notes/assets/js/30.33c143cb.js"><link rel="prefetch" href="/doc_notes/assets/js/300.c011f877.js"><link rel="prefetch" href="/doc_notes/assets/js/301.479875ba.js"><link rel="prefetch" href="/doc_notes/assets/js/302.fe22cf89.js"><link rel="prefetch" href="/doc_notes/assets/js/303.fe59bc5d.js"><link rel="prefetch" href="/doc_notes/assets/js/304.17566e0f.js"><link rel="prefetch" href="/doc_notes/assets/js/305.235d62da.js"><link rel="prefetch" href="/doc_notes/assets/js/306.6a899aaa.js"><link rel="prefetch" href="/doc_notes/assets/js/307.a6302576.js"><link rel="prefetch" href="/doc_notes/assets/js/308.53d18516.js"><link rel="prefetch" href="/doc_notes/assets/js/309.44746635.js"><link rel="prefetch" href="/doc_notes/assets/js/31.f3c83a33.js"><link rel="prefetch" href="/doc_notes/assets/js/310.2b0b41b5.js"><link rel="prefetch" href="/doc_notes/assets/js/311.a2425d85.js"><link rel="prefetch" href="/doc_notes/assets/js/312.ee8bb224.js"><link rel="prefetch" href="/doc_notes/assets/js/313.cdb7a074.js"><link rel="prefetch" href="/doc_notes/assets/js/314.5c46337b.js"><link rel="prefetch" href="/doc_notes/assets/js/315.d2f5d6ef.js"><link rel="prefetch" href="/doc_notes/assets/js/316.1d1b10d7.js"><link rel="prefetch" href="/doc_notes/assets/js/317.18978adf.js"><link rel="prefetch" href="/doc_notes/assets/js/318.725aaa9e.js"><link rel="prefetch" href="/doc_notes/assets/js/319.10c27323.js"><link rel="prefetch" href="/doc_notes/assets/js/32.2e4a5d25.js"><link rel="prefetch" href="/doc_notes/assets/js/320.be122112.js"><link rel="prefetch" href="/doc_notes/assets/js/321.21d59327.js"><link rel="prefetch" href="/doc_notes/assets/js/322.1c7aa8b5.js"><link rel="prefetch" href="/doc_notes/assets/js/323.61f2e664.js"><link rel="prefetch" href="/doc_notes/assets/js/324.d5ef212c.js"><link rel="prefetch" href="/doc_notes/assets/js/325.8dcaad1a.js"><link rel="prefetch" href="/doc_notes/assets/js/326.27ae755d.js"><link rel="prefetch" href="/doc_notes/assets/js/327.23295181.js"><link rel="prefetch" href="/doc_notes/assets/js/328.b1038029.js"><link rel="prefetch" href="/doc_notes/assets/js/329.685f438a.js"><link rel="prefetch" href="/doc_notes/assets/js/33.78d67de4.js"><link rel="prefetch" href="/doc_notes/assets/js/330.29d01e38.js"><link rel="prefetch" href="/doc_notes/assets/js/331.56ede5a6.js"><link rel="prefetch" href="/doc_notes/assets/js/332.26f5337e.js"><link rel="prefetch" href="/doc_notes/assets/js/333.7a1b5bed.js"><link rel="prefetch" href="/doc_notes/assets/js/334.ccc83ffa.js"><link rel="prefetch" href="/doc_notes/assets/js/335.dd4d24f2.js"><link rel="prefetch" href="/doc_notes/assets/js/336.5cd8a3be.js"><link rel="prefetch" href="/doc_notes/assets/js/337.725cd669.js"><link rel="prefetch" href="/doc_notes/assets/js/338.ca370789.js"><link rel="prefetch" href="/doc_notes/assets/js/339.4db35fe1.js"><link rel="prefetch" href="/doc_notes/assets/js/34.10602eab.js"><link rel="prefetch" href="/doc_notes/assets/js/340.11e5684e.js"><link rel="prefetch" href="/doc_notes/assets/js/341.87af888b.js"><link rel="prefetch" href="/doc_notes/assets/js/342.6288246d.js"><link rel="prefetch" href="/doc_notes/assets/js/343.10836901.js"><link rel="prefetch" href="/doc_notes/assets/js/344.85db1640.js"><link rel="prefetch" href="/doc_notes/assets/js/345.f1a97cf1.js"><link rel="prefetch" href="/doc_notes/assets/js/346.dd502824.js"><link rel="prefetch" href="/doc_notes/assets/js/347.b211385a.js"><link rel="prefetch" href="/doc_notes/assets/js/348.f255c270.js"><link rel="prefetch" href="/doc_notes/assets/js/349.36014517.js"><link rel="prefetch" href="/doc_notes/assets/js/35.03fbbb65.js"><link rel="prefetch" href="/doc_notes/assets/js/350.817bd0e1.js"><link rel="prefetch" href="/doc_notes/assets/js/351.abf45be4.js"><link rel="prefetch" href="/doc_notes/assets/js/352.4254451f.js"><link rel="prefetch" href="/doc_notes/assets/js/353.c0b15b9d.js"><link rel="prefetch" href="/doc_notes/assets/js/354.d725c37e.js"><link rel="prefetch" href="/doc_notes/assets/js/355.10f1ce9b.js"><link rel="prefetch" href="/doc_notes/assets/js/356.a5e2bfda.js"><link rel="prefetch" href="/doc_notes/assets/js/357.80f39a19.js"><link rel="prefetch" href="/doc_notes/assets/js/358.5c69b1d1.js"><link rel="prefetch" href="/doc_notes/assets/js/359.12d21c81.js"><link rel="prefetch" href="/doc_notes/assets/js/36.aa74ba81.js"><link rel="prefetch" href="/doc_notes/assets/js/360.1183658a.js"><link rel="prefetch" href="/doc_notes/assets/js/361.33b745b6.js"><link rel="prefetch" href="/doc_notes/assets/js/362.a56596c0.js"><link rel="prefetch" href="/doc_notes/assets/js/363.1fadef9e.js"><link rel="prefetch" href="/doc_notes/assets/js/364.e43e06a1.js"><link rel="prefetch" href="/doc_notes/assets/js/365.1b191379.js"><link rel="prefetch" href="/doc_notes/assets/js/366.77112bc2.js"><link rel="prefetch" href="/doc_notes/assets/js/367.cbbf1410.js"><link rel="prefetch" href="/doc_notes/assets/js/368.6e4af412.js"><link rel="prefetch" href="/doc_notes/assets/js/369.9d8214a4.js"><link rel="prefetch" href="/doc_notes/assets/js/37.bad965a6.js"><link rel="prefetch" href="/doc_notes/assets/js/370.5dcbc931.js"><link rel="prefetch" href="/doc_notes/assets/js/371.3e798a72.js"><link rel="prefetch" href="/doc_notes/assets/js/372.99fbe027.js"><link rel="prefetch" href="/doc_notes/assets/js/373.783fc78c.js"><link rel="prefetch" href="/doc_notes/assets/js/374.8fc2e9fe.js"><link rel="prefetch" href="/doc_notes/assets/js/375.2831b29c.js"><link rel="prefetch" href="/doc_notes/assets/js/376.8a690d9f.js"><link rel="prefetch" href="/doc_notes/assets/js/377.c6401c22.js"><link rel="prefetch" href="/doc_notes/assets/js/38.57a79422.js"><link rel="prefetch" href="/doc_notes/assets/js/39.7ab71035.js"><link rel="prefetch" href="/doc_notes/assets/js/4.da3ef268.js"><link rel="prefetch" href="/doc_notes/assets/js/40.ffa22594.js"><link rel="prefetch" href="/doc_notes/assets/js/41.b2fc54d1.js"><link rel="prefetch" href="/doc_notes/assets/js/42.c43bc930.js"><link rel="prefetch" href="/doc_notes/assets/js/43.5c93d7a1.js"><link rel="prefetch" href="/doc_notes/assets/js/44.605a54a6.js"><link rel="prefetch" href="/doc_notes/assets/js/45.f85a75a3.js"><link rel="prefetch" href="/doc_notes/assets/js/46.2cd25346.js"><link rel="prefetch" href="/doc_notes/assets/js/47.93f7d1a6.js"><link rel="prefetch" href="/doc_notes/assets/js/48.7fd0b6dc.js"><link rel="prefetch" href="/doc_notes/assets/js/49.c64bb839.js"><link rel="prefetch" href="/doc_notes/assets/js/5.dac787d8.js"><link rel="prefetch" href="/doc_notes/assets/js/50.d2fe7364.js"><link rel="prefetch" href="/doc_notes/assets/js/51.b9189617.js"><link rel="prefetch" href="/doc_notes/assets/js/52.4689b562.js"><link rel="prefetch" href="/doc_notes/assets/js/53.f0b1d96b.js"><link rel="prefetch" href="/doc_notes/assets/js/54.f52a48ab.js"><link rel="prefetch" href="/doc_notes/assets/js/55.98bfca4a.js"><link rel="prefetch" href="/doc_notes/assets/js/56.6c0a81f6.js"><link rel="prefetch" href="/doc_notes/assets/js/57.e17dfa82.js"><link rel="prefetch" href="/doc_notes/assets/js/58.f9a5000b.js"><link rel="prefetch" href="/doc_notes/assets/js/59.3296ea1c.js"><link rel="prefetch" href="/doc_notes/assets/js/6.2d0a63f8.js"><link rel="prefetch" href="/doc_notes/assets/js/60.610d4eca.js"><link rel="prefetch" href="/doc_notes/assets/js/61.64b18740.js"><link rel="prefetch" href="/doc_notes/assets/js/62.87e34293.js"><link rel="prefetch" href="/doc_notes/assets/js/63.fbd2d78b.js"><link rel="prefetch" href="/doc_notes/assets/js/64.493b857a.js"><link rel="prefetch" href="/doc_notes/assets/js/65.0a60479c.js"><link rel="prefetch" href="/doc_notes/assets/js/66.800419f9.js"><link rel="prefetch" href="/doc_notes/assets/js/67.343f5dab.js"><link rel="prefetch" href="/doc_notes/assets/js/68.fed77f78.js"><link rel="prefetch" href="/doc_notes/assets/js/69.8b1601da.js"><link rel="prefetch" href="/doc_notes/assets/js/7.c9d31aa2.js"><link rel="prefetch" href="/doc_notes/assets/js/70.aedd0ab9.js"><link rel="prefetch" href="/doc_notes/assets/js/71.b166238f.js"><link rel="prefetch" href="/doc_notes/assets/js/72.27a66c82.js"><link rel="prefetch" href="/doc_notes/assets/js/73.1d9b487f.js"><link rel="prefetch" href="/doc_notes/assets/js/74.84702901.js"><link rel="prefetch" href="/doc_notes/assets/js/75.2f6ae560.js"><link rel="prefetch" href="/doc_notes/assets/js/76.4856c210.js"><link rel="prefetch" href="/doc_notes/assets/js/77.9fc6950e.js"><link rel="prefetch" href="/doc_notes/assets/js/78.cb2f07a0.js"><link rel="prefetch" href="/doc_notes/assets/js/79.5e43d0b7.js"><link rel="prefetch" href="/doc_notes/assets/js/8.da9db8f9.js"><link rel="prefetch" href="/doc_notes/assets/js/80.d59ea8af.js"><link rel="prefetch" href="/doc_notes/assets/js/81.9fc53f43.js"><link rel="prefetch" href="/doc_notes/assets/js/82.5838801e.js"><link rel="prefetch" href="/doc_notes/assets/js/83.d2006fd2.js"><link rel="prefetch" href="/doc_notes/assets/js/84.9b965f14.js"><link rel="prefetch" href="/doc_notes/assets/js/85.de0c498b.js"><link rel="prefetch" href="/doc_notes/assets/js/86.ce67f8b8.js"><link rel="prefetch" href="/doc_notes/assets/js/87.5d47b003.js"><link rel="prefetch" href="/doc_notes/assets/js/88.eee9be64.js"><link rel="prefetch" href="/doc_notes/assets/js/89.42153946.js"><link rel="prefetch" href="/doc_notes/assets/js/9.0ccc34a6.js"><link rel="prefetch" href="/doc_notes/assets/js/90.13a9f4b2.js"><link rel="prefetch" href="/doc_notes/assets/js/91.832ae5d2.js"><link rel="prefetch" href="/doc_notes/assets/js/92.bd7c25ca.js"><link rel="prefetch" href="/doc_notes/assets/js/93.8a6f3f34.js"><link rel="prefetch" href="/doc_notes/assets/js/94.221348bd.js"><link rel="prefetch" href="/doc_notes/assets/js/95.86b48f96.js"><link rel="prefetch" href="/doc_notes/assets/js/96.7c6d0372.js"><link rel="prefetch" href="/doc_notes/assets/js/97.307341f8.js"><link rel="prefetch" href="/doc_notes/assets/js/98.14120c7c.js"><link rel="prefetch" href="/doc_notes/assets/js/99.40560c36.js">
    <link rel="stylesheet" href="/doc_notes/assets/css/0.styles.60b82a90.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-sidebar"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/doc_notes/" class="home-link router-link-active"><!----> <span class="site-name">Obsidian notes</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/doc_notes/guide/" class="nav-link">
  Guide
</a></div><div class="nav-item"><a href="/doc_notes/config/" class="nav-link">
  Config
</a></div><div class="nav-item"><a href="https://v1.vuepress.vuejs.org" target="_blank" rel="noopener noreferrer" class="nav-link external">
  VuePress
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/doc_notes/guide/" class="nav-link">
  Guide
</a></div><div class="nav-item"><a href="/doc_notes/config/" class="nav-link">
  Config
</a></div><div class="nav-item"><a href="https://v1.vuepress.vuejs.org" target="_blank" rel="noopener noreferrer" class="nav-link external">
  VuePress
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <!----> </aside> <main class="page"> <div class="theme-default-content content__default"><p>https://kernel.org/doc/html/next/userspace-api/netlink/intro.html</p> <h1 id="введение-в-netlink"><a href="#введение-в-netlink" class="header-anchor">#</a> Введение в Netlink <a href="https://kernel.org/doc/html/next/userspace-api/netlink/intro.html#introduction-to-netlink" title="Постоянная ссылка на этот заголовок" target="_blank" rel="noopener noreferrer"><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></h1> <p>Netlink часто называют заменой ioctl(). Он нацелен на замену структур C фиксированного формата, предоставляемых ioctl(), форматом, который позволяет легко добавлять или расширять аргументы.</p> <p>Для этого Netlink использует минимальный заголовок метаданных фиксированного формата, за которым следует несколько атрибутов в формате TLV (тип, длина, значение).</p> <p>К сожалению, с годами протокол развивался органичным и недокументированным образом, что затрудняет связное объяснение. Чтобы придать наиболее практический смысл, этот документ начинается с описания netlink в том виде, в каком он используется сегодня, и углубляется в более «исторические» варианты использования в последующих разделах.</p> <h2 id="открытие-сокета"><a href="#открытие-сокета" class="header-anchor">#</a> Открытие сокета <a href="https://kernel.org/doc/html/next/userspace-api/netlink/intro.html#opening-a-socket" title="Постоянная ссылка на этот заголовок" target="_blank" rel="noopener noreferrer"><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></h2> <p>Связь Netlink происходит через сокеты, сначала необходимо открыть сокет:</p> <p>fd = socket(AF_NETLINK, SOCK_RAW, NETLINK_GENERIC);</p> <p>Использование сокетов обеспечивает естественный способ обмена информацией в обоих направлениях (в ядро ​​и из него). Операции по-прежнему выполняются синхронно, когда приложения посылают() запрос, но для чтения ответа требуется отдельный системный вызов recv().</p> <p>Таким образом, очень упрощенный поток «вызова» Netlink будет выглядеть примерно так:</p> <p>fd = socket(AF_NETLINK, SOCK_RAW, NETLINK_GENERIC);</p> <p>/* format the request <em>/
send(fd, &amp;request, sizeof(request));
n = recv(fd, &amp;response, RSP_BUFFER_SIZE);
/</em> interpret the response */</p> <p>Netlink также обеспечивает естественную поддержку &quot;дампинга&quot;, т.е. передачи в пространство пользователя всех объектов определенного типа (например, сброса всех сетевых интерфейсов).</p> <p>fd = socket(AF_NETLINK, SOCK_RAW, NETLINK_GENERIC);</p> <p>/* format the dump request <em>/
send(fd, &amp;request, sizeof(request));
while (1) {
n = recv(fd, &amp;buffer, RSP_BUFFER_SIZE);
/</em> one recv() call can read multiple messages, hence the loop below <em>/
for (nl_msg in buffer) {
if (nl_msg.nlmsg_type == NLMSG_DONE)
goto dump_finished;
/</em> process the object */
}
}
dump_finished:</p> <p>Первые два аргумента вызова socket() требуют небольшого объяснения — это открытие сокета Netlink со всеми заголовками, предоставленными пользователем (отсюда NETLINK, RAW). Последний аргумент — это протокол в Netlink. Это поле используется для идентификации подсистемы, с которой сокет будет взаимодействовать.</p> <h3 id="классическии-и-универсальныи-netlink"><a href="#классическии-и-универсальныи-netlink" class="header-anchor">#</a> Классический и универсальный Netlink <a href="https://kernel.org/doc/html/next/userspace-api/netlink/intro.html#classic-vs-generic-netlink" title="Постоянная ссылка на этот заголовок" target="_blank" rel="noopener noreferrer"><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></h3> <p>Первоначальная реализация Netlink зависела от статического распределения идентификаторов подсистемам и обеспечивала небольшую вспомогательную инфраструктуру. Давайте будем называть эти протоколы вместе <strong>классическим Netlink</strong> . Их список определяется в верхней части <code>include/uapi/linux/netlink.h</code> файла, среди прочего они включают в себя общую сеть (NETLINK_ROUTE), iSCSI (NETLINK_ISCSI) и аудит (NETLINK_AUDIT).</p> <p><strong>Generic Netlink</strong> (представленный в 2005 г.) позволяет динамически регистрировать подсистемы (и выделять идентификаторы подсистем), проводить самоанализ и упрощает реализацию интерфейса на стороне ядра.</p> <p>В следующем разделе описывается, как использовать Generic Netlink, поскольку количество подсистем, использующих Generic Netlink, на порядок превышает количество старых протоколов. Также нет планов по добавлению в ядро ​​дополнительных протоколов Classic Netlink. Основная информация о том, чем взаимодействие с основными сетевыми частями ядра Linux (или другой из 20 подсистем, использующих Classic Netlink) отличается от Generic Netlink, представлена ​​далее в этом документе.</p> <h2 id="общая-сетевая-ссылка"><a href="#общая-сетевая-ссылка" class="header-anchor">#</a> Общая сетевая ссылка <a href="https://kernel.org/doc/html/next/userspace-api/netlink/intro.html#generic-netlink" title="Постоянная ссылка на этот заголовок" target="_blank" rel="noopener noreferrer"><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></h2> <p>В дополнение к фиксированному заголовку метаданных Netlink каждый протокол Netlink определяет свой собственный фиксированный заголовок метаданных. (Подобно стеку сетевых заголовков — Ethernet &gt; IP &gt; TCP, у нас есть Netlink &gt; Generic N. &gt; Family.)</p> <p>Сообщение Netlink всегда начинается с , за которым следует заголовок, относящийся к протоколу. В случае Generic Netlink заголовок протокола имеет вид struct genlmsghdr.<a href="https://kernel.org/doc/html/next/userspace-api/netlink/intro.html#c.nlmsghdr" title="nlmsghdr" target="_blank" rel="noopener noreferrer"><code>struct nlmsghdr</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>Практическое значение полей в случае Generic Netlink следующее:</p> <p>struct nlmsghdr {
__u32   nlmsg_len;      /* Length of message including headers <em>/
__u16   nlmsg_type;     /</em> Generic Netlink Family (subsystem) ID <em>/
__u16   nlmsg_flags;    /</em> Flags - request or dump <em>/
__u32   nlmsg_seq;      /</em> Sequence number <em>/
__u32   nlmsg_pid;      /</em> Port ID, set to 0 <em>/
};
struct genlmsghdr {
__u8    cmd;            /</em> Command, as defined by the Family <em>/
__u8    version;        /</em> Irrelevant, set to 1 <em>/
__u16   reserved;       /</em> Reserved, set to 0 <em>/
};
/</em> TLV attributes follow... */</p> <p>В Classic Netlink <code>nlmsghdr.nlmsg_type</code>используется для определения того, к какой операции внутри подсистемы относится сообщение (например, для получения информации о netdev). Generic Netlink необходимо мультиплексировать несколько подсистем в одном протоколе, поэтому он использует это поле для идентификации подсистемы и <code>genlmsghdr.cmd</code>вместо этого идентифицирует операцию. (См. <a href="https://kernel.org/doc/html/next/userspace-api/netlink/intro.html#res-fam" target="_blank" rel="noopener noreferrer">Разрешение идентификатора семейства<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> для получения информации о том, как найти идентификатор семейства интересующей подсистемы.) Обратите внимание, что первые 16 значений (0–15) этого поля зарезервированы для управляющих сообщений как в Classic Netlink, так и в Generic Netlink. Дополнительные сведения см. в <a href="https://kernel.org/doc/html/next/userspace-api/netlink/intro.html#nl-msg-type" target="_blank" rel="noopener noreferrer">разделе Типы сообщений Netlink .<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>В сокете Netlink существует 3 обычных типа обмена сообщениями:</p> <blockquote><ul><li><p>выполнение одного действия ( <code>do</code>);</p></li> <li><p>информация о сбросе ( <code>dump</code>);</p></li> <li><p>получение асинхронных уведомлений ( <code>multicast</code>).</p></li></ul></blockquote> <p>Классический Netlink очень гибок и, по-видимому, допускает другие типы обмена, но на практике используются только эти три.</p> <p>Асинхронные уведомления отправляются ядром и принимаются пользовательскими сокетами, подписавшимися на них. <code>do</code>и <code>dump</code>запросы инициируются пользователем. <code>nlmsghdr.nlmsg_flags</code>следует установить следующим образом:</p> <blockquote><ul><li><p>для <code>do</code>:<code>NLM_F_REQUEST | NLM_F_ACK</code></p></li> <li><p>для <code>dump</code>:<code>NLM_F_REQUEST | NLM_F_ACK | NLM_F_DUMP</code></p></li></ul></blockquote> <p><code>nlmsghdr.nlmsg_seq</code>должно быть установлено монотонно возрастающее значение. Это значение отображается в ответах и ​​на практике не имеет значения, но установка его на возрастающее значение для каждого отправленного сообщения считается хорошей гигиеной. Назначение поля — сопоставление ответов на запросы. Асинхронные уведомления будут <code>nlmsghdr.nlmsg_seq</code>иметь <code>0</code>.</p> <p><code>nlmsghdr.nlmsg_pid</code>является Netlink-эквивалентом адреса. Это поле может быть установлено <code>0</code>при общении с ядром. См. <a href="https://kernel.org/doc/html/next/userspace-api/netlink/intro.html#nlmsg-pid" target="_blank" rel="noopener noreferrer">nlmsg_pid<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> для (необычного) использования поля.</p> <p>Ожидаемое использование <code>genlmsghdr.version</code>состояло в том, чтобы разрешить управление версиями API, предоставляемых подсистемами. На сегодняшний день ни одна подсистема не использовала это поле в значительной степени, поэтому установка его на <code>1</code>кажется беспроигрышной ставкой.</p> <h3 id="типы-сообщении-netlink"><a href="#типы-сообщении-netlink" class="header-anchor">#</a> Типы сообщений Netlink <a href="https://kernel.org/doc/html/next/userspace-api/netlink/intro.html#netlink-message-types" title="Постоянная ссылка на этот заголовок" target="_blank" rel="noopener noreferrer"><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></h3> <p>Как упоминалось ранее, <code>nlmsghdr.nlmsg_type</code>содержит значения, специфичные для протокола, но первые 16 идентификаторов зарезервированы (первый тип сообщения, специфичный для подсистемы, должен быть равен <code>NLMSG_MIN_TYPE</code>) <code>0x10</code>.</p> <p>Определено только 4 управляющих сообщения Netlink:</p> <blockquote><ul><li><p><code>NLMSG_NOOP</code>- игнорировать сообщение, не используемое на практике;</p></li> <li><p><code>NLMSG_ERROR</code>- содержит код возврата операции;</p></li> <li><p><code>NLMSG_DONE</code>- отмечает конец дампа;</p></li> <li><p><code>NLMSG_OVERRUN</code>- буфер сокета переполнен, до сих пор не использовался.</p></li></ul></blockquote> <p><code>NLMSG_ERROR</code>и <code>NLMSG_DONE</code>имеют практическое значение. Они несут коды возврата для операций. Обратите внимание, что если <code>NLM_F_ACK</code>флаг не установлен в запросе, Netlink не будет отвечать, <code>NLMSG_ERROR</code>если нет ошибки. Чтобы избежать особого случая этой причуды, рекомендуется всегда устанавливать <code>NLM_F_ACK</code>.</p> <p>Формат <code>NLMSG_ERROR</code>описывается структурой nlmsgerr:</p> <hr> <table><thead><tr><th>struct nlmsghdr - response header</th></tr></thead> <tbody><tr><td>int error</td></tr></tbody></table> <hr> <table><thead><tr><th>struct nlmsghdr - original request header</th></tr></thead> <tbody><tr><td>** optionally (1) payload of the request</td></tr></tbody></table> <hr> <table><thead><tr><th>** optionally (2) extended ACK</th></tr></thead> <tbody></tbody></table> <p>Здесь есть два экземпляра : первый ответ и второй запрос. несет информацию о запросе, который привел к ошибке. Это может быть полезно при попытке сопоставить запросы с ответами или повторно проанализировать запрос, чтобы вывести его в журналы.<a href="https://kernel.org/doc/html/next/userspace-api/netlink/intro.html#c.nlmsghdr" title="nlmsghdr" target="_blank" rel="noopener noreferrer"><code>struct nlmsghdr</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a><code>NLMSG_ERROR</code></p> <p>Полезная нагрузка запроса не отображается в сообщениях, сообщающих об успешном выполнении ( ), или если установлена ​​функция setsockopt(). Последнее распространено и, возможно, рекомендуется, так как чтение копии каждого запроса из ядра довольно расточительно. Отсутствие полезной нагрузки запроса указывается в .<code>error == 0``NETLINK_CAP_ACK``NLM_F_CAPPED``nlmsghdr.nlmsg_flags</code></p> <p>Вторым необязательным элементом <code>NLMSG_ERROR</code>являются расширенные атрибуты ACK. Дополнительные сведения см. в <a href="https://kernel.org/doc/html/next/userspace-api/netlink/intro.html#ext-ack" target="_blank" rel="noopener noreferrer">разделе Расширенный ACK .<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> Наличие расширенного ACK указано <code>NLM_F_ACK_TLVS</code>в <code>nlmsghdr.nlmsg_flags</code>.</p> <p><code>NLMSG_DONE</code>проще, запрос никогда не повторяется, но могут присутствовать расширенные атрибуты ACK:</p> <hr> <table><thead><tr><th>struct nlmsghdr - response header</th></tr></thead> <tbody><tr><td>int error</td></tr></tbody></table> <hr> <table><thead><tr><th>** optionally extended ACK</th></tr></thead> <tbody></tbody></table> <h3 id="разрешение-семеиного-идентификатора"><a href="#разрешение-семеиного-идентификатора" class="header-anchor">#</a> Разрешение семейного идентификатора <a href="https://kernel.org/doc/html/next/userspace-api/netlink/intro.html#resolving-the-family-id" title="Постоянная ссылка на этот заголовок" target="_blank" rel="noopener noreferrer"><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></h3> <p>В этом разделе объясняется, как найти Family ID подсистемы. Он также служит примером связи Generic Netlink.</p> <p>Generic Netlink сама по себе является подсистемой, предоставляемой через Generic Netlink API. Чтобы избежать циклической зависимости, Generic Netlink имеет статически выделенный Family ID ( <code>GENL_ID_CTRL</code>который равен <code>NLMSG_MIN_TYPE</code>). Семейство Generic Netlink реализует команду, используемую для получения информации о других семействах ( <code>CTRL_CMD_GETFAMILY</code>).</p> <p>Чтобы получить информацию о названном семействе Generic Netlink, например, <code>&quot;test1&quot;</code>нам нужно отправить сообщение на ранее открытый сокет Generic Netlink. Сообщение должно быть нацелено на семейство Generic Netlink (1), быть <code>do</code>(2) вызовом <code>CTRL_CMD_GETFAMILY</code>(3). Версия <code>dump</code>этого вызова заставит ядро ​​ответить информацией обо <em>всех</em> известных ему семействах. И последнее, но не менее важное: имя рассматриваемого семейства должно быть указано (4) в качестве атрибута соответствующего типа:</p> <p>struct nlmsghdr:
__u32 nlmsg_len:    32
__u16 nlmsg_type:   GENL_ID_CTRL               // (1)
__u16 nlmsg_flags:  NLM_F_REQUEST | NLM_F_ACK  // (2)
__u32 nlmsg_seq:    1
__u32 nlmsg_pid:    0</p> <p>struct genlmsghdr:
__u8 cmd:           CTRL_CMD_GETFAMILY         // (3)
__u8 version:       2 /* or 1, doesn't matter */
__u16 reserved:     0</p> <p>struct nlattr:                                   // (4)
__u16 nla_len:      10
__u16 nla_type:     CTRL_ATTR_FAMILY_NAME
char data:          test1\0</p> <p>(padding:)
char data:          \0\0</p> <p>Поля длины в Netlink ( <code>nlmsghdr.nlmsg_len</code> и <code>nlattr.nla_len</code>) всегда <em>включают</em> заголовок. Заголовки атрибутов в netlink должны быть выровнены по 4 байтам от начала сообщения, поэтому <code>\0\0</code>после <code>CTRL_ATTR_FAMILY_NAME</code>. Длины атрибутов <em>исключают</em> заполнение.</p> <p>Если семейство найдено, ядро ​​ответит двумя сообщениями со всей информацией о семействе:</p> <p>/* Message #1 - reply <em>/
struct nlmsghdr:
__u32 nlmsg_len:    136
__u16 nlmsg_type:   GENL_ID_CTRL
__u16 nlmsg_flags:  0
__u32 nlmsg_seq:    1    /</em> echoed from our request <em>/
__u32 nlmsg_pid:    5831 /</em> The PID of our user space process */</p> <p>struct genlmsghdr:
__u8 cmd:           CTRL_CMD_GETFAMILY
__u8 version:       2
__u16 reserved:     0</p> <p>struct nlattr:
__u16 nla_len:      10
__u16 nla_type:     CTRL_ATTR_FAMILY_NAME
char data:          test1\0</p> <p>(padding:)
data:               \0\0</p> <p>struct nlattr:
__u16 nla_len:      6
__u16 nla_type:     CTRL_ATTR_FAMILY_ID
__u16:              123  /* The Family ID we are after */</p> <p>(padding:)
char data:          \0\0</p> <p>struct nlattr:
__u16 nla_len:      9
__u16 nla_type:     CTRL_ATTR_FAMILY_VERSION
__u16:              1</p> <p>/* ... etc, more attributes will follow. */</p> <p>И код ошибки (успех) с тех пор <code>NLM_F_ACK</code>был установлен по запросу:</p> <p>/* Message #2 - the ACK <em>/
struct nlmsghdr:
__u32 nlmsg_len:    36
__u16 nlmsg_type:   NLMSG_ERROR
__u16 nlmsg_flags:  NLM_F_CAPPED /</em> There won't be a payload <em>/
__u32 nlmsg_seq:    1    /</em> echoed from our request <em>/
__u32 nlmsg_pid:    5831 /</em> The PID of our user space process */</p> <p>int error:            0</p> <p>struct nlmsghdr: /* Copy of the request header as we sent it */
__u32 nlmsg_len:    32
__u16 nlmsg_type:   GENL_ID_CTRL
__u16 nlmsg_flags:  NLM_F_REQUEST | NLM_F_ACK
__u32 nlmsg_seq:    1
__u32 nlmsg_pid:    0</p> <p>Порядок атрибутов (struct nlattr) не гарантируется, поэтому пользователю приходится просматривать атрибуты и анализировать их.</p> <p>Обратите внимание, что сокеты Generic Netlink не связаны и не привязаны к одному семейству. Сокет можно использовать для обмена сообщениями со многими различными семействами, выбирая семейство получателей для каждого сообщения с помощью поля <code>nlmsghdr.nlmsg_type</code>.</p> <h3 id="расширенныи-ack"><a href="#расширенныи-ack" class="header-anchor">#</a> Расширенный ACK <a href="https://kernel.org/doc/html/next/userspace-api/netlink/intro.html#extended-ack" title="Постоянная ссылка на этот заголовок" target="_blank" rel="noopener noreferrer"><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></h3> <p>Расширенный ACK управляет отчетами о дополнительных ошибках/предупреждениях TLV в <code>NLMSG_ERROR</code>сообщениях <code>NLMSG_DONE</code>. Для обеспечения обратной совместимости эту функцию необходимо явно включить, установив <code>NETLINK_EXT_ACK</code>для setsockopt() значение <code>1</code>.</p> <p>Типы расширенных атрибутов ack определены в . Наиболее часто используемые атрибуты , и .<a href="https://kernel.org/doc/html/next/userspace-api/netlink/intro.html#c.nlmsgerr_attrs" title="nlmsgerr_attrs" target="_blank" rel="noopener noreferrer"><code>enum nlmsgerr_attrs</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a><code>NLMSGERR_ATTR_MSG``NLMSGERR_ATTR_OFFS``NLMSGERR_ATTR_MISS_*</code></p> <p><code>NLMSGERR_ATTR_MSG</code>содержит сообщение на английском языке с описанием возникшей проблемы. Эти сообщения гораздо более подробны, чем то, что может быть выражено с помощью стандартных кодов ошибок UNIX.</p> <p><code>NLMSGERR_ATTR_OFFS</code>указывает на атрибут, вызвавший проблему.</p> <p><code>NLMSGERR_ATTR_MISS_TYPE</code>и <code>NLMSGERR_ATTR_MISS_NEST</code> сообщить об отсутствующем атрибуте.</p> <p>Расширенные ACK могут сообщаться об ошибках, а также в случае успеха. Последнее следует рассматривать как предупреждение.</p> <p>Расширенные ACK значительно повышают удобство использования Netlink и всегда должны быть включены, должным образом анализироваться и сообщаться пользователю.</p> <h2 id="дополнительные-темы"><a href="#дополнительные-темы" class="header-anchor">#</a> Дополнительные темы <a href="https://kernel.org/doc/html/next/userspace-api/netlink/intro.html#advanced-topics" title="Постоянная ссылка на этот заголовок" target="_blank" rel="noopener noreferrer"><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></h2> <h3 id="согласованность-дампа"><a href="#согласованность-дампа" class="header-anchor">#</a> Согласованность дампа <a href="https://kernel.org/doc/html/next/userspace-api/netlink/intro.html#dump-consistency" title="Постоянная ссылка на этот заголовок" target="_blank" rel="noopener noreferrer"><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></h3> <p>Некоторые структуры данных, используемые ядром для хранения объектов, затрудняют предоставление атомарного снимка всех объектов в дампе (без влияния на быстрые пути их обновления).</p> <p>Ядро может установить <code>NLM_F_DUMP_INTR</code>флаг для любого сообщения в дампе (включая <code>NLMSG_DONE</code>сообщение), если дамп был прерван и может быть несогласованным (например, отсутствующие объекты). Пользовательское пространство должно повторить попытку создания дампа, если оно увидит установленный флаг.</p> <h3 id="самоанализ"><a href="#самоанализ" class="header-anchor">#</a> Самоанализ <a href="https://kernel.org/doc/html/next/userspace-api/netlink/intro.html#introspection" title="Постоянная ссылка на этот заголовок" target="_blank" rel="noopener noreferrer"><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></h3> <p>Основные возможности самоанализа активируются при доступе к объекту «Семья», как указано в <a href="https://kernel.org/doc/html/next/userspace-api/netlink/intro.html#res-fam" target="_blank" rel="noopener noreferrer">разделе «Разрешение идентификатора семьи»<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> . Пользователь может запросить информацию о семействе Generic Netlink, в том числе о том, какие операции поддерживаются ядром и какие атрибуты понимает ядро. Информация о семействе включает самый высокий идентификатор атрибута, который может анализировать ядро, отдельная команда ( <code>CTRL_CMD_GETPOLICY</code>) предоставляет подробную информацию о поддерживаемых атрибутах, включая диапазоны значений, которые принимает ядро.</p> <p>Запрос информации о семействе полезен в тех случаях, когда пользовательскому пространству необходимо убедиться, что ядро ​​​​поддерживает какую-либо функцию, прежде чем выдавать запрос.</p> <h3 id="nlmsg-pid"><a href="#nlmsg-pid" class="header-anchor">#</a> nlmsg_pid <a href="https://kernel.org/doc/html/next/userspace-api/netlink/intro.html#nlmsg-pid" title="Постоянная ссылка на этот заголовок" target="_blank" rel="noopener noreferrer"><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></h3> <p><code>nlmsghdr.nlmsg_pid</code>является Netlink-эквивалентом адреса. Он называется идентификатором порта, иногда идентификатором процесса, потому что по историческим причинам, если приложение не выбирает (bind() to) явный идентификатор порта, ядро ​​автоматически назначит ему идентификатор, равный его идентификатору процесса (как сообщает getpid( ) системный вызов).</p> <p>Подобно семантике bind() сетевых протоколов TCP/IP, нулевое значение означает «назначать автоматически», поэтому приложения обычно оставляют поле <code>nlmsghdr.nlmsg_pid</code>инициализированным до <code>0</code>.</p> <p>Поле до сих пор используется в редких случаях, когда ядру необходимо отправить одноадресное уведомление. Приложение пользовательского пространства может использовать bind(), чтобы связать свой сокет с определенным PID, а затем передать свой PID ядру. Таким образом ядро ​​​​может получить доступ к конкретному процессу пользовательского пространства.</p> <p>Этот тип связи используется в сценариях, подобных UMH (User Mode Helper), когда ядру необходимо инициировать обработку пользовательского пространства или запрашивать пользовательское пространство для решения политики.</p> <h3 id="многоадресные-уведомления"><a href="#многоадресные-уведомления" class="header-anchor">#</a> Многоадресные уведомления <a href="https://kernel.org/doc/html/next/userspace-api/netlink/intro.html#multicast-notifications" title="Постоянная ссылка на этот заголовок" target="_blank" rel="noopener noreferrer"><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></h3> <p>Одной из сильных сторон Netlink является возможность отправки уведомлений о событиях в пространство пользователя. Это однонаправленная форма связи (ядро -&gt; пользователь) и не включает никаких управляющих сообщений, таких как <code>NLMSG_ERROR</code>или <code>NLMSG_DONE</code>.</p> <p>Например, само семейство Generic Netlink определяет набор многоадресных уведомлений о зарегистрированных семействах. При добавлении нового семейства сокеты, подписанные на уведомления, получат следующее сообщение:</p> <p>struct nlmsghdr:
__u32 nlmsg_len:    136
__u16 nlmsg_type:   GENL_ID_CTRL
__u16 nlmsg_flags:  0
__u32 nlmsg_seq:    0
__u32 nlmsg_pid:    0</p> <p>struct genlmsghdr:
__u8 cmd:           CTRL_CMD_NEWFAMILY
__u8 version:       2
__u16 reserved:     0</p> <p>struct nlattr:
__u16 nla_len:      10
__u16 nla_type:     CTRL_ATTR_FAMILY_NAME
char data:          test1\0</p> <p>(padding:)
data:               \0\0</p> <p>struct nlattr:
__u16 nla_len:      6
__u16 nla_type:     CTRL_ATTR_FAMILY_ID
__u16:              123  /* The Family ID we are after */</p> <p>(padding:)
char data:          \0\0</p> <p>struct nlattr:
__u16 nla_len:      9
__u16 nla_type:     CTRL_ATTR_FAMILY_VERSION
__u16:              1</p> <p>/* ... etc, more attributes will follow. */</p> <p>Уведомление содержит ту же информацию, что и ответ на <code>CTRL_CMD_GETFAMILY</code>запрос.</p> <p>Заголовки Netlink уведомления в основном равны 0 и не имеют значения. Может <code>nlmsghdr.nlmsg_seq</code>быть либо нулем, либо монотонно возрастающим порядковым номером уведомления, поддерживаемым семейством.</p> <p>Для получения уведомлений пользовательский сокет должен подписаться на соответствующую группу уведомлений. Как и идентификатор семьи, идентификатор группы для данной многоадресной группы является динамическим и может быть найден в информации о семье. Атрибут <code>CTRL_ATTR_MCAST_GROUPS</code>содержит гнезда с именами ( <code>CTRL_ATTR_MCAST_GRP_NAME</code>) и идентификаторами ( <code>CTRL_ATTR_MCAST_GRP_ID</code>) семейства групп.</p> <p>Как только идентификатор группы известен, вызов setsockopt() добавляет сокет в группу:</p> <p>unsigned int group_id;</p> <p>/* .. find the group ID... */</p> <p>setsockopt(fd, SOL_NETLINK, NETLINK_ADD_MEMBERSHIP,
&amp;group_id, sizeof(group_id));</p> <p>Сокет теперь будет получать уведомления.</p> <p>Рекомендуется использовать отдельные сокеты для получения уведомлений и отправки запросов к ядру. Асинхронный характер уведомлений означает, что они могут смешиваться с ответами, что значительно усложняет обработку сообщений.</p> <h3 id="размер-буфера"><a href="#размер-буфера" class="header-anchor">#</a> Размер буфера <a href="https://kernel.org/doc/html/next/userspace-api/netlink/intro.html#buffer-sizing" title="Постоянная ссылка на этот заголовок" target="_blank" rel="noopener noreferrer"><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></h3> <p>Сокеты Netlink — это сокеты дейтаграмм, а не потоковые сокеты, что означает, что каждое сообщение должно быть получено полностью с помощью одного системного вызова recv()/recvmsg(). Если предоставленный пользователем буфер слишком короткий, сообщение будет усечено, а флаг <code>MSG_TRUNC</code>будет установлен в структуре msghdr (структура msghdr является вторым аргументом системного вызова recvmsg(), <em>а не</em> заголовком Netlink).</p> <p>После усечения оставшаяся часть сообщения отбрасывается.</p> <p>Netlink ожидает, что пользовательский буфер будет не менее 8 КБ или размер страницы архитектуры ЦП, в зависимости от того, что больше. Однако некоторым семействам Netlink может потребоваться буфер большего размера. Буфер размером 32 КБ рекомендуется для наиболее эффективной обработки дампов (больший буфер подходит для большего количества объектов дампа и, следовательно, требуется меньше вызовов recvmsg()).</p> <h2 id="классическии-нетлинк"><a href="#классическии-нетлинк" class="header-anchor">#</a> Классический нетлинк <a href="https://kernel.org/doc/html/next/userspace-api/netlink/intro.html#classic-netlink" title="Постоянная ссылка на этот заголовок" target="_blank" rel="noopener noreferrer"><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></h2> <p>Основными отличиями между Classic и Generic Netlink являются динамическое выделение идентификаторов подсистем и доступность самоанализа. Теоретически протокол существенно не отличается, однако на практике Classic Netlink экспериментировал с концепциями, от которых отказались в Generic Netlink (на самом деле они обычно находили применение только в небольшом уголке одной подсистемы). Этот раздел предназначен для объяснения некоторых из таких концепций с явной целью дать пользователям Generic Netlink уверенность в том, что они будут игнорировать их при чтении заголовков uAPI.</p> <p>Большинство понятий и примеров здесь относятся к <code>NETLINK_ROUTE</code>семейству, которое охватывает большую часть конфигурации сетевого стека Linux. Реальная документация этого семейства заслуживает отдельной главы (или книги).</p> <h3 id="семьи"><a href="#семьи" class="header-anchor">#</a> Семьи <a href="https://kernel.org/doc/html/next/userspace-api/netlink/intro.html#families" title="Постоянная ссылка на этот заголовок" target="_blank" rel="noopener noreferrer"><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></h3> <p>Netlink относится к подсистемам как к семействам. Это пережиток использования сокетов и концепции семейств протоколов, которые являются частью демультиплексирования сообщений в <code>NETLINK_ROUTE</code>.</p> <p>К сожалению, каждый уровень инкапсуляции любит называть все, что он несет, «семействами», что делает этот термин очень запутанным:</p> <blockquote><ol><li><p>AF_NETLINK — это добросовестное семейство протоколов сокетов.</p></li> <li><p>В документации AF_NETLINK то, что идет после собственного заголовка ( ) в сообщении, называется «семейным заголовком».<a href="https://kernel.org/doc/html/next/userspace-api/netlink/intro.html#c.nlmsghdr" title="nlmsghdr" target="_blank" rel="noopener noreferrer"><code>struct nlmsghdr</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></li> <li><p>Generic Netlink — это семейство для AF_NETLINK (следует структура genlmsghdr ), но оно также называет своих пользователей «Семействами».<a href="https://kernel.org/doc/html/next/userspace-api/netlink/intro.html#c.nlmsghdr" title="nlmsghdr" target="_blank" rel="noopener noreferrer"><code>struct nlmsghdr</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></li></ol></blockquote> <p>Обратите внимание, что идентификаторы семейства Generic Netlink находятся в другом «пространстве идентификаторов» и перекрываются с номерами протокола Classic Netlink (например, <code>NETLINK_CRYPTO</code> имеет идентификатор протокола Classic Netlink, равный 21, который Generic Netlink с радостью присвоит одному из своих семейств).</p> <h3 id="строгая-проверка"><a href="#строгая-проверка" class="header-anchor">#</a> Строгая проверка <a href="https://kernel.org/doc/html/next/userspace-api/netlink/intro.html#strict-checking" title="Постоянная ссылка на этот заголовок" target="_blank" rel="noopener noreferrer"><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></h3> <p>Опция <code>NETLINK_GET_STRICT_CHK</code>socket включает строгую проверку ввода <code>NETLINK_ROUTE</code>. Это было необходимо, потому что исторически ядро ​​не проверяло поля структур, которые оно не обрабатывало. Это сделало невозможным начать использовать эти поля позже, не рискуя регрессией в приложениях, которые инициализировали их неправильно или вообще не инициализировали.</p> <p><code>NETLINK_GET_STRICT_CHK</code>объявляет, что приложение правильно инициализирует все поля. Он также выбирает проверку того, что сообщение не содержит завершающих данных, и запрашивает, чтобы ядро ​​​​отклоняло атрибуты с типом выше, чем самый большой тип атрибута, известный ядру.</p> <p><code>NETLINK_GET_STRICT_CHK</code>не используется вне <code>NETLINK_ROUTE</code>.</p> <h3 id="неизвестные-атрибуты"><a href="#неизвестные-атрибуты" class="header-anchor">#</a> Неизвестные атрибуты <a href="https://kernel.org/doc/html/next/userspace-api/netlink/intro.html#unknown-attributes" title="Постоянная ссылка на этот заголовок" target="_blank" rel="noopener noreferrer"><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></h3> <p>Исторически Netlink игнорировал все неизвестные атрибуты. Мысль заключалась в том, что это избавит приложение от необходимости проверять, что поддерживает ядро. Приложение могло сделать запрос на изменение состояния и проверить, какие части запроса «зависли».</p> <p>Это больше не относится к новым семействам Generic Netlink и тем, кто выбирает строгую проверку. См. enum netlink_validation для типов выполненных проверок.</p> <h3 id="фиксированные-метаданные-и-структуры"><a href="#фиксированные-метаданные-и-структуры" class="header-anchor">#</a> Фиксированные метаданные и структуры <a href="https://kernel.org/doc/html/next/userspace-api/netlink/intro.html#fixed-metadata-and-structures" title="Постоянная ссылка на этот заголовок" target="_blank" rel="noopener noreferrer"><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></h3> <p>Классический Netlink широко использовал структуры фиксированного формата в сообщениях. Сообщения обычно имеют структуру со значительным количеством полей после . Также было принято размещать структуры с несколькими элементами внутри атрибутов, не разбивая каждый элемент на отдельный атрибут.<a href="https://kernel.org/doc/html/next/userspace-api/netlink/intro.html#c.nlmsghdr" title="nlmsghdr" target="_blank" rel="noopener noreferrer"><code>struct nlmsghdr</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>Это вызвало проблемы с проверкой и расширяемостью, поэтому использование двоичных структур для новых атрибутов активно не рекомендуется.</p> <h3 id="типы-запросов"><a href="#типы-запросов" class="header-anchor">#</a> Типы запросов <a href="https://kernel.org/doc/html/next/userspace-api/netlink/intro.html#request-types" title="Постоянная ссылка на этот заголовок" target="_blank" rel="noopener noreferrer"><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></h3> <p><code>NETLINK_ROUTE</code>классифицирует запросы на 4 типа <code>NEW</code>, <code>DEL</code>, <code>GET</code>и <code>SET</code>. Каждый объект может обрабатывать все или некоторые из этих запросов (объектами являются netdev, маршруты, адреса, qdisc и т. д.). Тип запроса определяется двумя младшими битами типа сообщения, поэтому команды для новых объектов всегда будут выделяться с шагом 4.</p> <p>Каждый объект также будет иметь собственные фиксированные метаданные, общие для всех типов запросов (например, struct ifinfomsg для запросов netdev, struct ifaddrmsg для запросов адреса, struct tcmsg для запросов qdisc).</p> <p>Несмотря на то, что другие протоколы и команды Generic Netlink часто используют одни и те же глаголы в именах сообщений ( <code>GET</code>, <code>SET</code>), концепция типов запросов не нашла широкого применения.</p> <h3 id="эхо-уведомление"><a href="#эхо-уведомление" class="header-anchor">#</a> Эхо-уведомление <a href="https://kernel.org/doc/html/next/userspace-api/netlink/intro.html#notification-echo" title="Постоянная ссылка на этот заголовок" target="_blank" rel="noopener noreferrer"><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></h3> <p><code>NLM_F_ECHO</code>запросы на уведомления, полученные в результате запроса, должны быть поставлены в очередь на запрашивающий сокет. Это полезно для обнаружения влияния запроса.</p> <p>Обратите внимание, что эта функция реализована не повсеместно.</p> <h3 id="другие-флаги-специфичные-для-типа-запроса"><a href="#другие-флаги-специфичные-для-типа-запроса" class="header-anchor">#</a> Другие флаги, специфичные для типа запроса <a href="https://kernel.org/doc/html/next/userspace-api/netlink/intro.html#other-request-type-specific-flags" title="Постоянная ссылка на этот заголовок" target="_blank" rel="noopener noreferrer"><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></h3> <p>Классический Netlink определил различные флаги для своих <code>GET</code>и запросов в старшем байте nlmsg_flags в . Поскольку типы запросов не были обобщены, флаги конкретных типов запросов используются редко (и считаются устаревшими для новых семейств).<code>NEW``DEL</code><a href="https://kernel.org/doc/html/next/userspace-api/netlink/intro.html#c.nlmsghdr" title="nlmsghdr" target="_blank" rel="noopener noreferrer"><code>struct nlmsghdr</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>Ибо <code>GET</code>- <code>NLM_F_ROOT</code>и <code>NLM_F_MATCH</code>объединяются в <code>NLM_F_DUMP</code>, а по отдельности не употребляются. <code>NLM_F_ATOMIC</code>никогда не используется.</p> <p>For <code>DEL</code>- <code>NLM_F_NONREC</code>используется только nftables и <code>NLM_F_BULK</code> только некоторыми операциями FDB.</p> <p>Флаги для <code>NEW</code>чаще всего используются в классическом Netlink. К сожалению, смысл не кристально ясен. Следующее описание основано на наилучшем предположении о замысле авторов, и на практике все семьи так или иначе отклоняются от него. <code>NLM_F_REPLACE</code>запрашивает замену существующего объекта, если совпадающий объект не существует, операция должна завершиться ошибкой. <code>NLM_F_EXCL</code>имеет противоположную семантику и завершается успешно только в том случае, если объект уже существует. <code>NLM_F_CREATE</code>просит создать объект, если он не существует, его можно комбинировать с <code>NLM_F_REPLACE</code>и <code>NLM_F_EXCL</code>.</p> <p>Комментарий в основном заголовке Netlink uAPI гласит:</p> <p>4.4BSD ADD           NLM_F_CREATE|NLM_F_EXCL
4.4BSD CHANGE        NLM_F_REPLACE</p> <p>True CHANGE          NLM_F_CREATE|NLM_F_REPLACE
Append               NLM_F_CREATE
Check                NLM_F_EXCL</p> <p>что, по-видимому, указывает на то, что эти флаги предшествуют типам запросов. <code>NLM_F_REPLACE</code>без <code>NLM_F_CREATE</code>изначально использовалось вместо <code>SET</code>команд. <code>NLM_F_EXCL</code>без <code>NLM_F_CREATE</code>использовался для проверки существования объекта без его создания, предположительно до появления <code>GET</code>команд.</p> <p><code>NLM_F_APPEND</code>указывает, что если с одним ключом может быть связано несколько объектов (например, несколько объектов следующего перехода для маршрута), новый объект должен быть добавлен в список, а не заменять весь список.</p> <h2 id="справочник-по-uapi"><a href="#справочник-по-uapi" class="header-anchor">#</a> Справочник по uAPI <a href="https://kernel.org/doc/html/next/userspace-api/netlink/intro.html#uapi-reference" title="Постоянная ссылка на этот заголовок" target="_blank" rel="noopener noreferrer"><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></h2> <p>структура nlmsghdr<a href="https://kernel.org/doc/html/next/userspace-api/netlink/intro.html#c.nlmsghdr" title="Постоянная ссылка на это определение" target="_blank" rel="noopener noreferrer"><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a><a href="https://kernel.org/doc/html/next/userspace-api/netlink/intro.html#c.nlmsghdr" title="Постоянная ссылка на это определение" target="_blank" rel="noopener noreferrer"><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>заголовок метаданных фиксированного формата сообщений Netlink</p> <p><strong>Определение</strong> :</p> <p>struct nlmsghdr {
__u32 nlmsg_len;
__u16 nlmsg_type;
__u16 nlmsg_flags;
__u32 nlmsg_seq;
__u32 nlmsg_pid;
};</p> <p><strong>Члены</strong></p> <p><code>nlmsg_len</code></p> <p>Длина сообщения, включая заголовок</p> <p><code>nlmsg_type</code></p> <p>Тип содержимого сообщения</p> <p><code>nlmsg_flags</code></p> <p>Дополнительные флаги</p> <p><code>nlmsg_seq</code></p> <p>Порядковый номер</p> <p><code>nlmsg_pid</code></p> <p>Отправка идентификатора порта процесса</p> <p>перечисление nlmsgerr_attrs<a href="https://kernel.org/doc/html/next/userspace-api/netlink/intro.html#c.nlmsgerr_attrs" title="Постоянная ссылка на это определение" target="_blank" rel="noopener noreferrer"><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a><a href="https://kernel.org/doc/html/next/userspace-api/netlink/intro.html#c.nlmsgerr_attrs" title="Постоянная ссылка на это определение" target="_blank" rel="noopener noreferrer"><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>атрибуты nlmsgerr</p> <p><strong>Константы</strong></p> <p><code>NLMSGERR_ATTR_UNUSED</code></p> <p>неиспользованный</p> <p><code>NLMSGERR_ATTR_MSG</code></p> <p>строка сообщения об ошибке (строка)</p> <p><code>NLMSGERR_ATTR_OFFS</code></p> <p>смещение недопустимого атрибута в исходном сообщении, считая от начала заголовка (u32)</p> <p><code>NLMSGERR_ATTR_COOKIE</code></p> <p>произвольный файл cookie, специфичный для подсистемы, который будет использоваться - в случае успеха - для идентификации созданного объекта или операции или аналогичного (двоичного)</p> <p><code>NLMSGERR_ATTR_POLICY</code></p> <p>политика для отклоненного атрибута</p> <p><code>NLMSGERR_ATTR_MISS_TYPE</code></p> <p>тип отсутствующего обязательного атрибута, <code>NLMSGERR_ATTR_MISS_NEST</code>не будет присутствовать, если атрибут отсутствовал на уровне сообщения</p> <p><code>NLMSGERR_ATTR_MISS_NEST</code></p> <p>смещение гнезда, где отсутствовал атрибут</p> <p><code>__NLMSGERR_ATTR_MAX</code></p> <p>количество атрибутов</p> <p><code>NLMSGERR_ATTR_MAX</code></p> <p>наивысший номер атрибута</p> <p>enum netlink_attribute_type<a href="https://kernel.org/doc/html/next/userspace-api/netlink/intro.html#c.netlink_attribute_type" title="Постоянная ссылка на это определение" target="_blank" rel="noopener noreferrer"><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a><a href="https://kernel.org/doc/html/next/userspace-api/netlink/intro.html#c.netlink_attribute_type" title="Постоянная ссылка на это определение" target="_blank" rel="noopener noreferrer"><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>тип атрибута</p> <p><strong>Константы</strong></p> <p><code>NL_ATTR_TYPE_INVALID</code></p> <p>неиспользованный</p> <p><code>NL_ATTR_TYPE_FLAG</code></p> <p>атрибут флага (присутствует/отсутствует)</p> <p><code>NL_ATTR_TYPE_U8</code></p> <p>8-битный беззнаковый атрибут</p> <p><code>NL_ATTR_TYPE_U16</code></p> <p>16-битный беззнаковый атрибут</p> <p><code>NL_ATTR_TYPE_U32</code></p> <p>32-битный беззнаковый атрибут</p> <p><code>NL_ATTR_TYPE_U64</code></p> <p>64-битный беззнаковый атрибут</p> <p><code>NL_ATTR_TYPE_S8</code></p> <p>8-битный атрибут со знаком</p> <p><code>NL_ATTR_TYPE_S16</code></p> <p>16-битный атрибут со знаком</p> <p><code>NL_ATTR_TYPE_S32</code></p> <p>32-битный атрибут со знаком</p> <p><code>NL_ATTR_TYPE_S64</code></p> <p>64-битный атрибут со знаком</p> <p><code>NL_ATTR_TYPE_BINARY</code></p> <p>двоичные данные, минимальная/максимальная длина может быть указана</p> <p><code>NL_ATTR_TYPE_STRING</code></p> <p>строка, минимальная/максимальная длина может быть указана</p> <p><code>NL_ATTR_TYPE_NUL_STRING</code></p> <p>Строка с нулевым завершением, может быть указана минимальная/максимальная длина</p> <p><code>NL_ATTR_TYPE_NESTED</code></p> <p>вложенный, т.е. содержимое этого атрибута состоит из податрибутов. Вложенная политика и maxtype внутри могут быть указаны.</p> <p><code>NL_ATTR_TYPE_NESTED_ARRAY</code></p> <p>вложенный массив, т. е. содержимое этого атрибута содержит вложенные атрибуты, тип которых не имеет значения (просто используется для разделения элементов массива), и каждый такой элемент массива снова имеет атрибуты, может быть указана политика для этих внутренних атрибутов и соответствующий maxtype.</p> <p><code>NL_ATTR_TYPE_BITFIELD32</code></p> <p><code>struct nla_bitfield32</code>атрибут</p> <p>enum netlink_policy_type_attr<a href="https://kernel.org/doc/html/next/userspace-api/netlink/intro.html#c.netlink_policy_type_attr" title="Постоянная ссылка на это определение" target="_blank" rel="noopener noreferrer"><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a><a href="https://kernel.org/doc/html/next/userspace-api/netlink/intro.html#c.netlink_policy_type_attr" title="Постоянная ссылка на это определение" target="_blank" rel="noopener noreferrer"><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>атрибуты типа политики</p> <p><strong>Константы</strong></p> <p><code>NL_POLICY_TYPE_ATTR_UNSPEC</code></p> <p>неиспользованный</p> <p><code>NL_POLICY_TYPE_ATTR_TYPE</code></p> <p>тип атрибута, (U32)<a href="https://kernel.org/doc/html/next/userspace-api/netlink/intro.html#c.netlink_attribute_type" title="netlink_attribute_type" target="_blank" rel="noopener noreferrer"><code>enum netlink_attribute_type</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><code>NL_POLICY_TYPE_ATTR_MIN_VALUE_S</code></p> <p>минимальное значение для целых чисел со знаком (S64)</p> <p><code>NL_POLICY_TYPE_ATTR_MAX_VALUE_S</code></p> <p>максимальное значение для целых чисел со знаком (S64)</p> <p><code>NL_POLICY_TYPE_ATTR_MIN_VALUE_U</code></p> <p>минимальное значение для целых чисел без знака (U64)</p> <p><code>NL_POLICY_TYPE_ATTR_MAX_VALUE_U</code></p> <p>максимальное значение для целых чисел без знака (U64)</p> <p><code>NL_POLICY_TYPE_ATTR_MIN_LENGTH</code></p> <p>минимальная длина для бинарных атрибутов, без минимальной длины, если она не указана (U32)</p> <p><code>NL_POLICY_TYPE_ATTR_MAX_LENGTH</code></p> <p>максимальная длина для бинарных атрибутов, максимума нет, если он не указан (U32)</p> <p><code>NL_POLICY_TYPE_ATTR_POLICY_IDX</code></p> <p>подполитика для вложенных и вложенных типов массивов (U32)</p> <p><code>NL_POLICY_TYPE_ATTR_POLICY_MAXTYPE</code></p> <p>максимальный атрибут подполитики для вложенных и вложенных типов массивов, теоретически он может быть &lt; размера политики, на которую указывает индекс, если он ограничен внутри вложенности (U32)</p> <p><code>NL_POLICY_TYPE_ATTR_BITFIELD32_MASK</code></p> <p>допустимая маска для типа bitfield32 (U32)</p> <p><code>NL_POLICY_TYPE_ATTR_PAD</code></p> <p>атрибут pad для 64-битного выравнивания</p> <p><code>NL_POLICY_TYPE_ATTR_MASK</code></p> <p>маска допустимых битов для целых чисел без знака (U64)</p> <p><code>__NL_POLICY_TYPE_ATTR_MAX</code></p> <p>количество атрибутов</p> <p><code>NL_POLICY_TYPE_ATTR_MAX</code></p> <p>наивысший номер атрибута</p></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/doc_notes/assets/js/app.d7b7570d.js" defer></script><script src="/doc_notes/assets/js/2.733019b2.js" defer></script><script src="/doc_notes/assets/js/142.266c8a69.js" defer></script>
  </body>
</html>
