(window.webpackJsonp=window.webpackJsonp||[]).push([[323],{593:function(r,e,t){"use strict";t.r(e);var a=t(14),o=Object(a.a)({},(function(){var r=this,e=r._self._c;return e("ContentSlotsDistributor",{attrs:{"slot-key":r.$parent.slotKey}},[e("p",[r._v("17 апреля 2023 года «Яндекс» "),e("a",{attrs:{href:"https://vc.ru/claim/557828-yandeks-pochta-halyava-konchilas",target:"_blank",rel:"noopener noreferrer"}},[r._v("отключает бесплатную почту для бизнеса"),e("OutboundLink")],1),r._v(" и предлагает платить "),e("a",{attrs:{href:"https://360.yandex.ru/business/tariff/",target:"_blank",rel:"noopener noreferrer"}},[r._v("от 249 до 1399₽"),e("OutboundLink")],1),r._v(" за юзера в месяц. Если не оплатить услуги, все аккаунты "),e("a",{attrs:{href:"https://360.yandex.ru/",target:"_blank",rel:"noopener noreferrer"}},[r._v("«Яндекс 360»"),e("OutboundLink")],1),r._v(" будут принудительно переведены в режим чтения, то есть читать письма будет можно, а отвечать на них — нет.")]),r._v(" "),e("p",[r._v("Переход на платные тарифы обязателен для всех доменов (включая семейные аккаунты) с количеством пользователей больше трёх.")]),r._v(" "),e("p",[r._v("Конечно, легче всего согласиться на условия и оплатить требуемую сумму. На это и рассчитывает провайдер, что 99% клиентов молча заплатят деньги, ведь у них нет другого выхода… Но на самом деле выход есть.")]),r._v(" "),e("p",[r._v("Если в двух словах, можно взять недорогой VPS, поставить туда один из свободных почтовых серверов и сэкономить пару тысяч рублей. Или сотен тысяч, смотря сколько у вас сотрудников. Финансовая раскладка под катом.")]),r._v(" "),e("p",[r._v("Рассмотрим плюсы и минусы своего сервера.")]),r._v(" "),e("p",[r._v("Главный плюс — это деньги. Как известно, сэкономленный рубль не отличается от заработанного. То есть сэкономленные на оплате тарифа деньги — чистая прибыль вашей компании, которую можно пустить в оборот, выплатить дивиденды и премии сотрудникам.")]),r._v(" "),e("p",[r._v("Давайте посчитаем, сколько денег мы получим при переходе с «Яндекса» на свой почтовый сервер. «Яндекс» предлагает для бизнеса три тарифа: базовый, оптимальный и расширенный. Они отличаются количеством места на Диске для каждого сотрудника (от 100 ГБ до 3 ТБ), количеством писем в рассылках (от 1500 до 100 000), наличием/отсутствием трансляций, функции единого входа (SSO), защищённого архива рабочих писем и срока действия публичных ссылок для скачивания.")]),r._v(" "),e("p",[r._v("Тарифы «Яндекса» для бизнеса, а также свой VPS для разного количества пользователей, цена за год:")]),r._v(" "),e("p",[r._v("Количество сотрудников")]),r._v(" "),e("p",[r._v("Тариф «Яндекса»")]),r._v(" "),e("p",[r._v("Свой VPS (Москва)")]),r._v(" "),e("p",[r._v("Базовый")]),r._v(" "),e("p",[r._v("Оптимальный")]),r._v(" "),e("p",[r._v("Расширенный")]),r._v(" "),e("p",[e("em",[r._v("10")])]),r._v(" "),e("p",[r._v("29 880₽")]),r._v(" "),e("p",[r._v("56 280₽")]),r._v(" "),e("p",[r._v("167 880₽")]),r._v(" "),e("p",[r._v("18 300₽")]),r._v(" "),e("p",[e("em",[r._v("50")])]),r._v(" "),e("p",[r._v("149 400₽")]),r._v(" "),e("p",[r._v("281 400₽")]),r._v(" "),e("p",[r._v("839 400₽")]),r._v(" "),e("p",[r._v("44 712₽")]),r._v(" "),e("p",[e("em",[r._v("300")])]),r._v(" "),e("p",[r._v("337 680₽")]),r._v(" "),e("p",[r._v("1 688 400₽")]),r._v(" "),e("p",[r._v("5 036 400₽")]),r._v(" "),e("p",[r._v("77 436₽")]),r._v(" "),e("p",[r._v("*Примечание. Для своего сервера в "),e("a",{attrs:{href:"https://ruvds.com/ru-rub#order",target:"_blank",rel:"noopener noreferrer"}},[r._v("конфигураторе VPS"),e("OutboundLink")],1),r._v(" установлены следующие характеристики:")]),r._v(" "),e("ul",[e("li",[e("p",[r._v("10 пользователей — Intel Xeon, 2,2 ГГц (1 CPU), 4 ГБ RAM, HDD 100 ГБ;")])]),r._v(" "),e("li",[e("p",[r._v("50 пользователей — Intel Xeon, 2,2 ГГц (3 CPU), 8 ГБ RAM, HDD 300 ГБ;")])]),r._v(" "),e("li",[e("p",[r._v("300 пользователей — Intel Xeon, 3,4 ГГц (6 CPU), 8 ГБ RAM, HDD 600 ГБ.")])])]),r._v(" "),e("p",[r._v("В расчёте годовой цены указан только основной диск, без учёта подключения дополнительных HDD (500₽ за терабайт в месяц)")]),r._v(" "),e("p",[r._v("Во сколько конкретно обойдётся виртуалка на Linux с почтовым сервером, можно посмотреть в "),e("a",{attrs:{href:"https://ruvds.com/ru-rub#order",target:"_blank",rel:"noopener noreferrer"}},[r._v("конфигураторе"),e("OutboundLink")],1),r._v(".")]),r._v(" "),e("p",[e("img",{attrs:{src:"https://habrastorage.org/r/w1560/webt/sx/jj/ve/sxjjveau64stc4deag7sakhayt8.png",alt:""}})]),r._v(" "),e("p",[r._v("На первый взгляд кажется, что на «Яндексе» более дешёвое дисковое пространство, чем на своём хостинге. У них можно взять «Расширенный» пакет с 3 ТБ для каждого сотрудника за 1399₽ в месяц, а на своём хостинге каждый дополнительный терабайт обойдётся ежемесячно в 500₽ (которые нужно прибавить к сумме в таблице выше). Но в реальности на своём сервере дополнительное место докупают "),e("em",[r._v("по мере необходимости")]),r._v(", а «Яндекс» требует оплатить всё и сразу. Причём минимум 100 ГБ на каждого пользователя. Независимо от того, используете вы это место или нет. Поэтому в базовой таблице мы указали только изначальную конфигурацию сервера. А если почтовый архив разрастётся, к нему постепенно докупают терабайты раз в несколько лет. Бэкапы можно делать локально (и хранить бесплатно).")]),r._v(" "),e("p",[r._v("Аналогичные расчёты мы уже приводили в статье "),e("a",{attrs:{href:"https://habr.com/ru/companies/ruvds/articles/715010/",target:"_blank",rel:"noopener noreferrer"}},[r._v("«Как использовать GitLab в условиях санкций?»"),e("OutboundLink")],1),r._v(" про переезд на собственный сервер Gitlab. Тут наблюдается схожий эффект — с определённого количества пользователей переход на свой сервер становится выгодным и почти неизбежным.")]),r._v(" "),e("p",[r._v("Экономия денег — основное преимущество собственного почтового сервера. А вот главные недостатки:")]),r._v(" "),e("ol",[e("li",[e("p",[r._v("Сложность в установке и настройке.")])]),r._v(" "),e("li",[e("p",[r._v("Большие усилия на поддержку. Имеется в виду не техническая поддержка, которая сводится к периодическому "),e("code",[r._v("apt-get upgrade")]),r._v(" и занимает "),e("a",{attrs:{href:"https://schumacher.sh/2021/05/10/running-a-private-mail-server-for-six-years-easy-peasy.html",target:"_blank",rel:"noopener noreferrer"}},[r._v("10–15 минут в месяц"),e("OutboundLink")],1),r._v(", а усилия по защите репутации. Об этом ниже.")])])]),r._v(" "),e("h2",{attrs:{id:"▍-1-установка"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#▍-1-установка"}},[r._v("#")]),r._v(" ▍ 1. Установка")]),r._v(" "),e("p",[r._v("По первому пункту можно рекомендовать "),e("a",{attrs:{href:"https://flurdy.com/docs/postfix/",target:"_blank",rel:"noopener noreferrer"}},[r._v("подробную инструкцию"),e("OutboundLink")],1),r._v(" по установке и настройке продвинутого почтового сервера под Linux. Пакет установки включает Ubuntu + Postfix + Courier/Dovecot IMAP + MySQL + Amavisd-new + SpamAssassin + ClamAV + SASL + TLS + Roundcube + Postgrey. В итоге мы получаем полноценный сервер с неограниченным количеством пользователей и доменов, доступом по IMAP, фильтром спама, антивирусом, безопасной аутентификацией, шифрованием трафика и веб-интерфейсом. При этом не платим никакому почтовому провайдеру ни копейки. Всё полностью под своим контролем.")]),r._v(" "),e("p",[r._v("Это набор в максимальной конфигурации по типу «всё включено». В минимальном варианте для работы почтового сервера достаточно двух пакетов: Postfix (SMTP) и Dovecot (IMAP), плюс записи в DNS. Это всё. Совсем необязательно устанавливать СУБД для архива, антивирусы, антиспам и прочие модули. На самом деле можно начать с минимума, а потом добавлять эти модули по мере необходимости.")]),r._v(" "),e("p",[r._v("Пошаговая инструкция начинается с установки Ubuntu 20.04, но по факту можно поставить другой дистрибутив, и дальнейшие инструкции не теряют своей актуальности. И ещё один момент: в инструкции инстансы поднимаются на Amazon AWS, но исключительно в демонстрационных целях. Всю установку можно провести на локальном ПК у себя дома, в офисе или на VPS у хостера.")]),r._v(" "),e("p",[e("img",{attrs:{src:"https://habrastorage.org/r/w1560/webt/24/no/cu/24nocuxc4vl3rreiq_lxqwlor6m.png",alt:""}}),e("br"),r._v(" "),e("em",[r._v("Схема почтового сервера на FreeBSD с использованием Postfix, Dovecot, Rspamd и LDAP, "),e("a",{attrs:{href:"https://www.c0ffee.net/blog/mail-server-guide",target:"_blank",rel:"noopener noreferrer"}},[r._v("источник"),e("OutboundLink")],1)])]),r._v(" "),e("h2",{attrs:{id:"▍-2-защита-репутации"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#▍-2-защита-репутации"}},[r._v("#")]),r._v(" ▍ 2. Защита репутации")]),r._v(" "),e("p",[r._v("По части защиты репутации проблема в том, что крупные почтовые провайдеры типа Gmail, Hotmail и той же «Яндекс.Почты» "),e("a",{attrs:{href:"https://research.google.com/pubs/archive/45.pdf",target:"_blank",rel:"noopener noreferrer"}},[r._v("постоянно пытаются отфильтровать наши письма как спам"),e("OutboundLink")],1),r._v(". То есть письма с нашего сервера просто не доходят до адресатов. Вот "),e("a",{attrs:{href:"https://bridge.grumpy-troll.org/2020/07/small-mailserver-bcp/",target:"_blank",rel:"noopener noreferrer"}},[r._v("основные рекомендации"),e("OutboundLink")],1),r._v(", как этого избежать:")]),r._v(" "),e("ul",[e("li",[e("p",[r._v("SPF и DKIM с правильными настройками;")])]),r._v(" "),e("li",[e("p",[r._v("запись DMARC;")])]),r._v(" "),e("li",[e("p",[r._v("ограничить количество отправляемых сообщений;")])]),r._v(" "),e("li",[e("p",[r._v("использовать специализированные сервисы, такие как "),e("a",{attrs:{href:"https://www.gmail.com/postmaster/",target:"_blank",rel:"noopener noreferrer"}},[r._v("Postmaster Tools"),e("OutboundLink")],1),r._v(" от Gmail, чтобы отслеживать репутацию домена и оптимизировать настройки;")])]),r._v(" "),e("li",[e("p",[r._v("кроме репутации домена, следить за репутацией IP-адреса. Периодическая проверка чёрных списков "),e("a",{attrs:{href:"https://check.spamhaus.org/",target:"_blank",rel:"noopener noreferrer"}},[r._v("на сайте Spamhaus"),e("OutboundLink")],1),r._v(" и в специальных сервисах типа SenderScore.org;")]),r._v(" "),e("p",[e("img",{attrs:{src:"https://habrastorage.org/r/w1560/webt/o6/dw/is/o6dwisipshpybdaebpsgvyf3jj4.png",alt:""}})])]),r._v(" "),e("li",[e("p",[r._v("аккуратный выбор записей DNS и записи MX;")])]),r._v(" "),e("li",[e("p",[r._v("сертификат Let’s Encrypt;")])]),r._v(" "),e("li",[e("p",[r._v("использовать "),e("a",{attrs:{href:"https://www.fail2ban.org/",target:"_blank",rel:"noopener noreferrer"}},[r._v("fail2ban"),e("OutboundLink")],1),r._v(" и сканировать серверные логи для проверки, что через ваш сервер не пересылается спам;")])]),r._v(" "),e("li",[e("p",[r._v("очень важно "),e("a",{attrs:{href:"https://www.spamhaus.org/news/article/719/a-survival-guide-for-the-small-mail-server",target:"_blank",rel:"noopener noreferrer"}},[r._v("выбрать правильного хостера"),e("OutboundLink")],1),r._v(".")])])]),r._v(" "),e("p",[r._v("Проверка своего почтового домена на сайте "),e("a",{attrs:{href:"https://www.mail-tester.com/",target:"_blank",rel:"noopener noreferrer"}},[r._v("Mailtester"),e("OutboundLink")],1),r._v(":")]),r._v(" "),e("p",[e("img",{attrs:{src:"https://habrastorage.org/r/w1560/webt/r5/at/f8/r5atf8ujk4ousebmhm-58uillwu.jpeg",alt:""}})]),r._v(" "),e("h2",{attrs:{id:"▍-выбор-почтового-сервера"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#▍-выбор-почтового-сервера"}},[r._v("#")]),r._v(" ▍ Выбор почтового сервера")]),r._v(" "),e("p",[r._v("В "),e("a",{attrs:{href:"https://habr.com/ru/companies/ruvds/articles/729742/#1",target:"_blank",rel:"noopener noreferrer"}},[r._v("упомянутой выше"),e("OutboundLink")],1),r._v(" инструкции по установке почтового сервера используется самый простой опенсорсный софт:")]),r._v(" "),e("ul",[e("li",[e("p",[e("strong",[r._v("Почтовый сервер")]),r._v(": "),e("a",{attrs:{href:"http://www.postfix.org/",target:"_blank",rel:"noopener noreferrer"}},[r._v("Postfix"),e("OutboundLink")],1),r._v(".")])]),r._v(" "),e("li",[e("p",[e("strong",[r._v("Pop/IMAP")]),r._v(": "),e("a",{attrs:{href:"https://www.courier-mta.org/imap/",target:"_blank",rel:"noopener noreferrer"}},[r._v("Courier IMAP"),e("OutboundLink")],1),r._v(" или "),e("a",{attrs:{href:"https://www.dovecot.org/",target:"_blank",rel:"noopener noreferrer"}},[r._v("Dovecot"),e("OutboundLink")],1),r._v(".")])]),r._v(" "),e("li",[e("p",[e("strong",[r._v("СУБД")]),r._v(": MySQL.")])])]),r._v(" "),e("p",[r._v("Но в реальности существует "),e("a",{attrs:{href:"https://en.wikipedia.org/wiki/List_of_mail_server_software",target:"_blank",rel:"noopener noreferrer"}},[r._v("огромный выбор почтовых серверов"),e("OutboundLink")],1),r._v(", которые можно использовать. Некоторые из них хорошо известны, а другие появились совсем недавно:")]),r._v(" "),e("ul",[e("li",[e("p",[e("a",{attrs:{href:"http://www.postfix.org/",target:"_blank",rel:"noopener noreferrer"}},[r._v("Postfix"),e("OutboundLink")],1),r._v(" (SMTP),")])]),r._v(" "),e("li",[e("p",[e("a",{attrs:{href:"https://www.dovecot.org/",target:"_blank",rel:"noopener noreferrer"}},[r._v("Dovecot"),e("OutboundLink")],1),r._v(" (IMAP),")])]),r._v(" "),e("li",[e("p",[e("a",{attrs:{href:"https://www.opensmtpd.org/",target:"_blank",rel:"noopener noreferrer"}},[r._v("OpenSMTPD"),e("OutboundLink")],1),r._v(",")])]),r._v(" "),e("li",[e("p",[e("a",{attrs:{href:"https://www.proofpoint.com/us/products/email-protection/open-source-email-solution",target:"_blank",rel:"noopener noreferrer"}},[r._v("Sendmail"),e("OutboundLink")],1),r._v(",")])]),r._v(" "),e("li",[e("p",[e("a",{attrs:{href:"https://github.com/al3x/sovereign",target:"_blank",rel:"noopener noreferrer"}},[r._v("Sovereign"),e("OutboundLink")],1),r._v(" для Ansible,")])]),r._v(" "),e("li",[e("p",[e("a",{attrs:{href:"https://www.axigen.com/",target:"_blank",rel:"noopener noreferrer"}},[r._v("Axigen"),e("OutboundLink")],1),r._v(",")])]),r._v(" "),e("li",[e("p",[e("a",{attrs:{href:"https://james.apache.org/",target:"_blank",rel:"noopener noreferrer"}},[r._v("Apache James"),e("OutboundLink")],1),r._v(",")])]),r._v(" "),e("li",[e("p",[e("a",{attrs:{href:"https://citadel.org/",target:"_blank",rel:"noopener noreferrer"}},[r._v("Citadel"),e("OutboundLink")],1),r._v(",")])]),r._v(" "),e("li",[e("p",[e("a",{attrs:{href:"https://www.courier-mta.org/",target:"_blank",rel:"noopener noreferrer"}},[r._v("Courier Mail Server"),e("OutboundLink")],1),r._v(",")])]),r._v(" "),e("li",[e("p",[e("a",{attrs:{href:"https://www.exim.org/",target:"_blank",rel:"noopener noreferrer"}},[r._v("Exim"),e("OutboundLink")],1),r._v(",")])]),r._v(" "),e("li",[e("p",[e("a",{attrs:{href:"http://kolab.org/",target:"_blank",rel:"noopener noreferrer"}},[r._v("Kolab"),e("OutboundLink")],1),r._v(".")])])]),r._v(" "),e("p",[e("a",{attrs:{href:"https://en.wikipedia.org/wiki/Comparison_of_mail_servers",target:"_blank",rel:"noopener noreferrer"}},[r._v("Сравнение"),e("OutboundLink")],1),r._v(" почтовых серверов по функциональности:")]),r._v(" "),e("p",[e("img",{attrs:{src:"https://habrastorage.org/r/w1560/webt/ki/4a/ho/ki4ahoiwctxpqvcwflfza-cxnuw.png",alt:""}})]),r._v(" "),e("p",[r._v("Другие интересные разработки:")]),r._v(" "),e("ul",[e("li",[e("p",[e("a",{attrs:{href:"https://salmon-mail.readthedocs.io/en/latest/",target:"_blank",rel:"noopener noreferrer"}},[r._v("Salmon"),e("OutboundLink")],1),r._v(" — почтовый сервер на чистом Python.")])]),r._v(" "),e("li",[e("p",[e("a",{attrs:{href:"https://maddy.email/",target:"_blank",rel:"noopener noreferrer"}},[r._v("Maddy Mail Server"),e("OutboundLink")],1),r._v(" — один демон, который заменяет собой Postfix, Dovecot, OpenDKIM, OpenSPF и OpenDMARC.")])]),r._v(" "),e("li",[e("p",[e("a",{attrs:{href:"https://poste.io/",target:"_blank",rel:"noopener noreferrer"}},[r._v("Poste.io"),e("OutboundLink")],1),r._v(" — SMTP + IMAP + POP3 + антиспам + антивирус + веб-админка + веб-почта в одном пакете. Ставится на сервере за пять минут.")]),r._v(" "),e("p",[e("img",{attrs:{src:"https://habrastorage.org/r/w1560/webt/zu/d6/8f/zud68fnxd0txinmepgdjf3hpulc.png",alt:""}})]),r._v(" "),e("p",[r._v("**")]),r._v(" "),e("p",[e("strong",[r._v("Скриншоты Poste.io")])]),r._v(" "),e("p",[r._v("**")])]),r._v(" "),e("li",[e("p",[e("a",{attrs:{href:"https://github.com/mjl-/mox",target:"_blank",rel:"noopener noreferrer"}},[r._v("Mox"),e("OutboundLink")],1),r._v(" — ещё один простой в установке пакет «всё в одном» (SMTP, IMAP, SPF/DKIM/DMARC, фильтрация спама).")])])]),r._v(" "),e("p",[r._v("Нужно добавить, что поддержка почтового сервера — не такая критическая задача, как мониторинг аптайма веб-сервера. Даже если ваш сервер уйдёт в офлайн на пару дней (или IP занесут в чёрный список), входящая и исходящая почта всё равно будет отправлена и получена после его возвращения в строй (или выхода из блеклиста). Электронная почта — крайне надёжная технология. Это самый успешный децентрализованный протокол в истории интернета. Тут сложно напортачить или что-то испортить, она работает "),e("em",[r._v("в любых условиях")]),r._v(".")]),r._v(" "),e("p",[e("strong",[r._v("Примечание 1.")]),r._v(" Некоторые пользователи склоняются к мнению, что после 17 апреля можно перейти на почту Mail.ru, которая пока остаётся бесплатной. Но нужно понимать, что те причины, которые вынудили «Яндекс» ввести платные тарифы (удорожание инфраструктуры и дефицит серверов из-за санкций), действуют для Mail.ru тоже, так что такая миграция — временное решение. В конце концов придётся решать проблему кардинально и переходить на свой VPS, если вы хотите организовать почтовый сервер надёжно, дёшево и полностью под своим контролем, без "),e("a",{attrs:{href:"https://www.cloudflare.com/products/email-routing/",target:"_blank",rel:"noopener noreferrer"}},[r._v("перенаправления"),e("OutboundLink")],1),r._v(" "),e("a",{attrs:{href:"https://forwardemail.net/en",target:"_blank",rel:"noopener noreferrer"}},[r._v("почты"),e("OutboundLink")],1),r._v(" (кстати, это тоже выход — почта со всех адресов вашего домена перенаправляется в любой указанный ящик).")]),r._v(" "),e("p",[e("strong",[r._v("Примечание 2.")]),r._v(" Если хотите сохранить почтовый домен для семьи, то Gmail принял решение "),e("a",{attrs:{href:"https://myaccount.google.com/family/create",target:"_blank",rel:"noopener noreferrer"}},[r._v("оставить такие группы бесплатными до шести человек"),e("OutboundLink")],1),r._v(" (у «Яндекса» до трёх).")])])}),[],!1,null,null,null);e.default=o.exports}}]);