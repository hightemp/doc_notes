(window.webpackJsonp=window.webpackJsonp||[]).push([[63],{334:function(t,a,e){"use strict";e.r(a);var r=e(14),s=Object(r.a)({},(function(){var t=this,a=t._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("p",[t._v("http://xgu.ru/wiki/%D0%9C%D0%B0%D1%80%D1%88%D1%80%D1%83%D1%82%D0%B8%D0%B7%D0%B0%D1%86%D0%B8%D1%8F_%D0%B2_Linux")]),t._v(" "),a("p",[a("a",{attrs:{href:"http://xgu.ru/wiki/Linux",title:"Linux",target:"_blank",rel:"noopener noreferrer"}},[t._v("Linux"),a("OutboundLink")],1),t._v(" предоставляет большой набор функций для маршрутизации и инструменты для ее настройки. Ядро 2.6.x поддерживает:")]),t._v(" "),a("ul",[a("li",[t._v("Простую статическую маршрутизацию.")]),t._v(" "),a("li",[a("a",{attrs:{href:"http://xgu.ru/w/index.php?title=Equal_Cost_Multi_Path&action=edit&redlink=1",title:"Equal Cost Multi Path (такой страницы не существует)",target:"_blank",rel:"noopener noreferrer"}},[t._v("Equal Cost Multi Path"),a("OutboundLink")],1),t._v(" маршруты (маршруты до одной сети с одинаковым весом, которые выбираются с равной вероятностью).")]),t._v(" "),a("li",[a("a",{attrs:{href:"http://xgu.ru/wiki/Blackhole",title:"Blackhole",target:"_blank",rel:"noopener noreferrer"}},[t._v("Blackhole"),a("OutboundLink")],1),t._v("-маршруты.")]),t._v(" "),a("li",[t._v("Множественные таблицы маршрутизации.")]),t._v(" "),a("li",[a("a",{attrs:{href:"http://xgu.ru/w/index.php?title=Policy_Based_Routing&action=edit&redlink=1",title:"Policy Based Routing (такой страницы не существует)",target:"_blank",rel:"noopener noreferrer"}},[t._v("Policy Based Routing"),a("OutboundLink")],1)])]),t._v(" "),a("h2",{attrs:{id:"команды"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#команды"}},[t._v("#")]),t._v(" Команды")]),t._v(" "),a("p",[t._v("Для управления маршрутизацией применяются следующие команды: route, netstat, ip (последняя из пакета iproute2, возможно его придется установить).")]),t._v(" "),a("p",[t._v("Просмотреть таблицу можно следующими способами:")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v(" route -n   (устаревшее)\n netstat -rn\n ip route show\n cat /proc/net/route\n")])])]),a("p",[t._v("При этом следует учитывать, что доступ ко всем возможностям дает только ip. Используя route вы не только не сможете настроить «продвинутые» функции вроде политик маршрутизации, но и не увидите их существование в выводе команды просмотра, если они уже настроены в системе. Поэтому следует по возможности использовать ip.")]),t._v(" "),a("p",[t._v("Модификация таблицы маршрутизации:")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v(" ip [опции]\n route [опции]\n")])])]),a("h2",{attrs:{id:"использование-route"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#использование-route"}},[t._v("#")]),t._v(" Использование route")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v(" Добавление маршрута через шлюз: route add -net 192.168.0.0/16 gw 10.0.0.1\n Добавление маршрута через интерфейс: route add -net 192.168.0.0/16 dev eth1\n Маршрут до отдельного хоста: route add -host 192.168.0.1 gw 172.16.0.1\n Удаление маршрута: route del ...\n")])])]),a("h3",{attrs:{id:"использование-ip"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#использование-ip"}},[t._v("#")]),t._v(" Использование ip")]),t._v(" "),a("p",[t._v("Синтаксис ip по структуре напоминает синтаксис Cisco IOS. Любые опции могут быть сокращены до потери двусмысленности, например «ip ro ad» вместо «ip route add».")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v(" Добавление маршрута через шлюз: ip route add 172.16.10.0/24 via 192.168.1.1\n Добавление маршрута через интерфейс: ip route add 172.16.10.0/24 dev eth0\n Маршрут с метрикой: ip route add 172.16.10.0/24 dev eth0 metric 100\n")])])]),a("p",[t._v("Командой вида ip route add blackhole 10.56.50.0/27 можно добавить «зануленный» маршрут (аналог «ip route ... null0» в Cisco). Пакеты в сеть с таким маршрутом будут удалены с причиной «No route to host». Может быть полезно для подавление DoS-атаки с хоста или иных подобных случаев.")]),t._v(" "),a("h4",{attrs:{id:"деиствия-с-маршрутами"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#деиствия-с-маршрутами"}},[t._v("#")]),t._v(" Действия с маршрутами")]),t._v(" "),a("p",[t._v("Кроме add также поддерживаются и другие действия:")]),t._v(" "),a("ul",[a("li",[t._v("del — удалить маршрут.")]),t._v(" "),a("li",[t._v("replace — заменить маршрут другим.")]),t._v(" "),a("li",[t._v("change — изменить параметры маршрута.")])]),t._v(" "),a("h4",{attrs:{id:"equal-cost-multi-path"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#equal-cost-multi-path"}},[t._v("#")]),t._v(" Equal Cost Multi Path")]),t._v(" "),a("p",[t._v("Если добавить два маршрута до одной и той же сети с одинаковой метрикой, ядро начнет распределять нагрузку между ними путем выбора того или другого с равной вероятностью. Работает и для более чем двух маршрутов. "),a("strong",[t._v("Предупреждение:")]),t._v(" это может вызвать проблемы со входящими соединениями, потому что иногда ответ может пойти по другому маршруту, чем пришел запрос. Будьте осторожны.")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v(" ip route add default dev eth0\n ip route add default dev eth1\n")])])]),a("h4",{attrs:{id:"ipv6"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ipv6"}},[t._v("#")]),t._v(" IPv6")]),t._v(" "),a("p",[t._v("Настройка маршрутизации IPv6 почти идентична настройке для IPv4.")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v(" ip route add ::/0 via 2001:db8:dead:beef::1/64\n")])])]),a("p",[t._v("В некоторых дистрибутивах еще есть нерешенная проблема с маршрутом по умолчанию (например, старые версии RHEL), используйте")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("ip route add 2000::/3 ...\n")])])]),a("p",[t._v("в этом случае.")]),t._v(" "),a("h4",{attrs:{id:"просмотр-маршрутов-до-определеннои-сети"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#просмотр-маршрутов-до-определеннои-сети"}},[t._v("#")]),t._v(" Просмотр маршрутов до определенной сети")]),t._v(" "),a("p",[t._v("На маршрутизаторах с длинной таблицей может быть неудобно просматривать вывод «ip route show» в поисках нужного маршрута. В этом случае можно использовать команду вида:")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v(" ip route show 10.0.0.0/8\n")])])]),a("p",[t._v("которая выведет маршруты только до указанной сети.")]),t._v(" "),a("h2",{attrs:{id:"пересылка-пакетов-между-интерфеисами"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#пересылка-пакетов-между-интерфеисами"}},[t._v("#")]),t._v(" Пересылка пакетов между интерфейсами")]),t._v(" "),a("p",[t._v("Linux позволяет разрешить или запретить пересылку пакетов между интерфейсами (forwarding). На рабочих станциях и серверах приложений ее можно запретить, на маршрутизаторах или межсетевых экранах она, очевидно, должна быть разрешена.")]),t._v(" "),a("p",[t._v("За этот параметр для IPv4 отвечает переменная net.ipv4.ip_forward (1 = «разрешить», 0 = «запретить»).")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v(" cat /proc/sys/net/ipv4/ip_forward\n echo 1 > /proc/sys/net/ipv4/ip_forward\n")])])]),a("p",[t._v("Для IPv6 используйте net.ipv6.conf.all.forwarding")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("cat /proc/sys/net/ipv6/conf/all/forwarding\necho 1 > /proc/sys/net/ipv6/conf/all/forwarding\n")])])]),a("p",[t._v("Чтобы настройки сохранились после перезагрузки, пропишите значения net.ipv4.ip_forward и net.ipv6.conf.all.forwarding в /etc/sysctl.conf.")]),t._v(" "),a("h2",{attrs:{id:"конфигурационные-фаилы"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#конфигурационные-фаилы"}},[t._v("#")]),t._v(" Конфигурационные файлы")]),t._v(" "),a("p",[t._v("Настройки статической маршрутизации находятся в различных файлах, в зависимости от дистрибутива.")]),t._v(" "),a("ul",[a("li",[t._v("Debian GNU/Linux: /etc/network/interfaces")]),t._v(" "),a("li",[t._v("RHEL/CentOS/Scientifix: etc/sysconfig/network-scripts/route-interface name")]),t._v(" "),a("li",[t._v("Gentoo: /etc/conf.d/net")])]),t._v(" "),a("h2",{attrs:{id:"policy-routing"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#policy-routing"}},[t._v("#")]),t._v(" Policy routing")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v(" ip route add default via 10.0.1.2\n ip rule add from 192.168.1.1 lookup 3\n ip route add default via 10.0.3.4 table 3\n")])])]),a("p",[t._v("Для хоста 192.168.1.1 используется особенная таблица маршрутизации (table 3), не такая как для всех остальных хостов. В ней указан единственный маршрут — маршрут по умолчанию.")]),t._v(" "),a("p",[t._v("Все будут ходить через шлюз 10.0.1.2, а 192.168.1.1 — через 10.0.3.4.")])])}),[],!1,null,null,null);a.default=s.exports}}]);