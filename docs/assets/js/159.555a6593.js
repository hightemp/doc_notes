(window.webpackJsonp=window.webpackJsonp||[]).push([[159],{429:function(t,s,e){"use strict";e.r(s);var a=e(14),r=Object(a.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("p",[t._v("https://www.ylsoftware.com/news/727")]),t._v(" "),s("p",[t._v("Протокол SSH будучи достаточно функционален сам по себе часто становится основой других решений. Одно из таких решение это "),s("a",{attrs:{href:"https://github.com/sshuttle/sshuttle",target:"_blank",rel:"noopener noreferrer"}},[t._v("sshuttle"),s("OutboundLink")],1),t._v(" - простой VPN сервис, ограничения которого компенсируются простотой в использовании. Если у вас есть SSH-аккаунт на каком либо сервере с возможностью запуска python то вы уже можете использовать этот сервер в качестве VPN-сервера.")]),t._v(" "),s("h3",{attrs:{id:"установка"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#установка"}},[t._v("#")]),t._v(" Установка")]),t._v(" "),s("p",[t._v("Установить sshuttle в Ubuntu 18.04 можно командой:")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("apt install sshuttle\n")])])]),s("h3",{attrs:{id:"возможности-и-ограничения"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#возможности-и-ограничения"}},[t._v("#")]),t._v(" Возможности и ограничения")]),t._v(" "),s("p",[t._v('Важно понимать что всё-таки sshuttle это не полноценный VPN. В самом простом случае в туннель "заворачивается" только TCP-трафик. После некоторых манипуляций можно "завернуть" ещё и UDP, но всё остальные протоколы всё равно "пойдут" через ваше основное соединение. Поэтому sshuttle пригоден для доступа в закрытую сеть с целью администрирования, но никак не подходит для сокрытия оригинального IP-адреса.')]),t._v(" "),s("h3",{attrs:{id:"базовое-использование"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#базовое-использование"}},[t._v("#")]),t._v(" Базовое использование")]),t._v(" "),s("p",[t._v("Типовая команда запуска sshuttle выглядит примерно так:")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("sshuttle --remote=user@some.host 192.168.200.0/24\n")])])]),s("p",[t._v("Здесь параметры означают следующее:")]),t._v(" "),s("ul",[s("li",[s("strong",[t._v("--remote=user@some.host")]),t._v(': подключаемся к серверу "some.host" с логином "user".')]),t._v(" "),s("li",[s("strong",[t._v("192.168.200.0/24")]),t._v(": подсеть, трафик на которую мы завернём в наш туннель.")])]),t._v(" "),s("p",[t._v("Подключившись таким образом к офисному шлюзу можно свободно подключаться к компьютерам в офисной локальной сети по SSH или RDP. Важно: для того чтобы всё прошло успешно нужно запускать sshuttle от имени суперпользователя или иметь настроенный sudo, который необходим sshuttle для внесения изменений в файрволл.")]),t._v(" "),s("p",[t._v('В ряде случаев может возникнуть потребность пустить весь TCP-трафик через туннель. В этом случае недостаточно указать в качестве подсети "0.0.0.0/0", но ещё и необходимо с помощью опции --exclude сохранить нетронутым машрут до сервера. В итоге команда запуска будет выглядеть примерно так:')]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("sshuttle --exclude=some.host --remote=user@some.host 0.0.0.0/0\n")])])]),s("p",[t._v("Если вы не доверяете DNS-серверам своего провайдера то можете настроить перехват DNS-трафика с помощью опции "),s("strong",[t._v("--dns")]),t._v(". А если вы хотите видеть подробную информацию о работе сервиса то вам поможет опция "),s("strong",[t._v("--verbose")]),t._v(".")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://www.ylsoftware.com/images/2018/10/sshuttle.jpg",alt:"Запуск sshuttle в терминале KDE",title:"Запуск sshuttle в терминале KDE"}})]),t._v(" "),s("h3",{attrs:{id:"дополнительно"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#дополнительно"}},[t._v("#")]),t._v(" Дополнительно")]),t._v(" "),s("p",[t._v('Если кроме протокола TCP необходимо перенаправить ещё и UDP или есть потребность в поддержке IPv6 то понадобится некоторая подготовка. Надо создать новую таблицу маршрутизации и "завернуть" в неё трафик, который будет промаркирован с помощью sshuttle. Для этого последовательно от имени суперпользователя надо выполнить команды:')]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("# Новая таблица для IPv4\nip route add local default dev lo table 100\n\n# Заворачиваем маркированный IPv4-трафик с меткой 1\nip rule add fwmark 1 lookup 100\n\n# Новая таблица для IPv6\nip -6 route add local default dev lo table 100\n\n# Заворачиваем маркированный IPv6-трафик с меткой 1\nip -6 rule add fwmark 1 lookup 100\n")])])]),s("p",[t._v("После этого надо запустить sshuttle с опцией --method=tproxy. В этом режиме запуск возможен только от имени суперпользователя. Итоговая команда будет выглядеть примерно так:")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("sudo sshuttle --exclude=some.host --remote=user@some.host --dns --method=tproxy 0.0.0.0/0\n")])])]),s("h3",{attrs:{id:"заключение"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#заключение"}},[t._v("#")]),t._v(" Заключение")]),t._v(" "),s("p",[t._v("Sshuttle хотя и не является полноценным VPN, однако способен в ряде случаев его заменить. А благодаря "),s("a",{attrs:{href:"https://sshuttle.readthedocs.io/",target:"_blank",rel:"noopener noreferrer"}},[t._v("подробной документации"),s("OutboundLink")],1),t._v(" с ним справится даже начинающий пользователь. Из минусов можно отметить отсутствие возможности привычным способом управлять сетевыми маршрутами.")])])}),[],!1,null,null,null);s.default=r.exports}}]);