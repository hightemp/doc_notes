(window.webpackJsonp=window.webpackJsonp||[]).push([[57],{328:function(t,s,a){"use strict";a.r(s);var n=a(14),v=Object(n.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("p",[t._v("Наступает момент, когда системному администратору необходимо определить дату последнего входа в систему каждого из пользователей, а также подготовить список тех аккаунтов, которые этого так и не сделали. Если б Вы ранее не знали команду "),s("strong",[t._v("lastlog")]),t._v(", то удивились бы, насколько легко и быстро она может предоставить Вам эти данные.")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://habrastorage.org/r/w1560/files/f23/026/8fc/f230268fc02240e4b288e05108e62b65.jpg",alt:""}})]),t._v(" "),s("p",[t._v("Если же Вы все-таки задумались об этом, то не забывайте, что данная команда — это также один из хороших методов проверки безопасности, которую можно проводить на серверах под управлением Linux систем. Она поможет Вам установить потенциальные проблемы. Те аккаунты, которые были неактивны в течение долгого времени, например, может означать, что они больше не нужны и могут быть отключены. А вот аккаунты, которые были активны в то время, когда их пользователи должны были быть в отпуске где-нибудь на Багамах — могут намекать о проблемах с безопасностью на сервере.")]),t._v(" "),s("p",[t._v("Команда "),s("strong",[t._v("lastlog")]),t._v(" хранит информацию о последнем входе пользователя в систему, но он предоставит информацию только по тем логам, которые имеются в файле "),s("strong",[t._v("wtmp")]),t._v(". Записи в данном файле делаются в двоичном формате, так что просматривать их можно только с помощью специальных команд. Думаю многие из Вас обращали внимание на то, что когда Вы авторизируетесь в консоли, на экране появляется примерно следующее сообщение:")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("Last login: Wed Nov 11 13:19:44 on ttys002\n")])])]),s("p",[t._v("Эта строка формируется утилитой "),s("strong",[t._v("login")]),t._v(", которая после авторизации пользователя обращается к файлу /var/log/lastlog, извлекает оттуда информацию о предыдущем успешном входе, выдает ее на экран, а затем обновляет запись в файле "),s("strong",[t._v("lastlog")]),t._v(". В отличие от файла /var/log/lastlog, который содержит записи о времени последнего входа в систему каждого пользователя, в файле /var/log/wtmp запоминаются все входы и выходы пользователей в систему с момента создания этого файла.")]),t._v(" "),s("p",[t._v("Что бы посмотреть данные по конкретному пользователю необходимо использовать следующую команду "),s("strong",[t._v("last xxx")]),t._v(", где "),s("strong",[t._v("ххх")]),t._v(" — логин пользователя. А использование команды сортировки "),s("strong",[t._v("head")]),t._v(" с параметром 5 в свою очередь поможет Вам отобразить на экране только 5 последних результатов:")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("# last | head -5\nroot     pts/0        193.178.187.30   Wed Nov 11 14:21   still logged in   \ntuto     ftpd3292     ::ffff:176.104.0 Wed Nov 11 11:11 - 11:15  (00:04)    \ntuto     ftpd29523    ::ffff:176.104.0 Tue Nov 10 18:58 - 19:03  (00:04)    \nnaturcok ftpd23502    ::ffff:176.104.0 Tue Nov 10 13:55 - 13:55  (00:00)    \nnaturcok ftpd20128    ::ffff:176.104.0 Tue Nov 10 13:50 - 13:55  (00:05) \n")])])]),s("p",[t._v("Как “глубоко” Вы можете просмотреть историю последних команд зависит от того как долго существует файл "),s("strong",[t._v("wtmp")]),t._v(". Например, Вы можете использовать утилиту "),s("strong",[t._v("logrotate")]),t._v(", которая следит за файлами протоколов и обеспечивает так называемую ротацию этих файлов в случае, если они превысили указанный размер (или по истечению указанного временного интервала). Также она позволяет поддерживать более одного "),s("strong",[t._v("wtmp")]),t._v(" файл и имеет запись в "),s("strong",[t._v("logrotate.conf")]),t._v(" наподобие этой:")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("/var/log/wtmp {\n    monthly\n    create 0664 root utmp\n        minsize 1M\n    rotate 1\n}\n")])])]),s("p",[t._v("Даже имея несколько файлов "),s("strong",[t._v("wtmp")]),t._v(", данные некоторых Ваших пользователей могут просто не отобразиться. Если в результате индивидуальной проверки пользователя Вы никаких данных по нем не получили, то это означает, что записей по конкретному пользователю в файле "),s("strong",[t._v("wtmp")]),t._v(" нет. Чтобы узнать дату создания файла "),s("strong",[t._v("wtmp")]),t._v(", следует ввести в консоли "),s("strong",[t._v("last mia")]),t._v(":")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("# last mia\n\nwtmp begins Thu Sep 17 16:10:00 2015\n")])])]),s("p",[t._v("Лучшим способом найти информацию о последнем входе в систему для каждого пользователя является использование команды "),s("strong",[t._v("lastlog")]),t._v(". Если какой-либо из пользователей никогда не авторизировался в системе, то вместо имени терминала и времени последнего входа будет указана строка "),s("strong",[t._v("Never logged in")]),t._v(". Если результат вывода будет состоять из большого количества строк, то можете использовать еще и команду "),s("strong",[t._v("more")]),t._v(", которая в отличие от команды "),s("strong",[t._v("less")]),t._v(", выведет содержимое файла на экран отдельными страницами. Результат будет выглядеть примерно так:")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("# lastlog | more\nUsername         Port     From             Latest\nroot             pts/0    xxx.xxx.xxx.xxx   Wed Nov 11 14:21:59 +0200 2015\nbin                                        **Never logged in**\ndaemon                                     **Never logged in**\nadm                                        **Never logged in**\nispmaster        pts/0    xxx.xxx.xxx.xxx   Thu Nov  5 17:00:44 +0200 2015\n")])])]),s("p",[t._v("Многие из нас возможно будут удивлены, увидев, что bin, daemon, adm и другие служебные учетные записи никогда не авторизировались в системе. Это и в самом деле так, и означает лишь только то, что для оболочек, назначенных в момент регистрации пользователей (login shells), задан параметр /sbin/nologin, что делает авторизацию невозможной. Остальные данные по входам показывают дату и время системы, с которой была осуществлена авторизация.")]),t._v(" "),s("p",[t._v("Чтобы создать список всех учетных записей, которые никогда не входили в систему, стоит использовать следующий набор команд. С командой "),s("strong",[t._v("lastlog")]),t._v(" мы уже знакомы и я на ней подробно останавливаться не буду, дальше стоит добавить утилиту "),s("strong",[t._v("grep")]),t._v(" для поиска по ключевому слову, в нашем случаи это слово "),s("strong",[t._v("Never")]),t._v(", а для того, чтобы выводился только первый столбец с данными, можно воспользоваться утилитой "),s("strong",[t._v("awk")]),t._v(" со следующим синтаксисом — "),s("strong",[t._v("'{print $1}'")]),t._v(":")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("# lastlog | grep Never | awk '{print $1}'\nbin\ndaemon\nadm\n. . .\nntp\nuser1819\nuser1939\n")])])]),s("p",[t._v("Записи в "),s("strong",[t._v("lastlog")]),t._v(" перечислены согласно идентификаторов пользователей (User identifier — UID) — от суперпользователя (root) до пользователя с самым большим значением UID в Вашем файле /etc/passwd. Это связано с форматом самого файла "),s("strong",[t._v("lastlog")]),t._v(". В отличие от большинства лог-файл Unix, в файле "),s("strong",[t._v("lastlog")]),t._v(" для записи логов каждого пользователя резервируется отдельное место, и в свою очередь место каждой записи проиндексировано по UID. После этого файлы будут фиксированного размера, особенно если Ваша система имеет аккаунты с наивысшим лимитом своего возможного диапазона UID — такого как 16-битный UID 65536. Также при этом образуется большой объем неиспользуемого пространства, правда только в том случаи если Ваши идентификаторы не являются строго последовательными. Если же Ваша система поддерживает 32-битные UIDы, файл может быть очень большим и иметь 4 294 967 296 (232) различных значений идентификаторов.")]),t._v(" "),s("p",[t._v("Каждая запись в файле "),s("strong",[t._v("lastlog")]),t._v(" содержит имя пользователя, имя терминала, с которого вошел пользователь и время последнего входа в систему. Запись для суперпользователя (UID 0) в верхней части файла может иметь следующий вид:")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("# od -xc /var/log/lastlog | more\n0000000    fba3    563d    7470    2f73    0030    0000    0000    0000\n        243 373   =   V   p   t   s   /   0  \\0  \\0  \\0  \\0  \\0  \\0  \\0\n0000020    0000    0000    0000    0000    0000    0000    0000    0000\n         \\0  \\0  \\0  \\0  \\0  \\0  \\0  \\0  \\0  \\0  \\0  \\0  \\0  \\0  \\0  \\0\n0000040    0000    0000    3138    392e    2e35    3831    2e34    3532\n         \\0  \\0  \\0  \\0   8   1   .   9   5   .   1   8   4   .   2   5\n0000060    0034    0000    0000    0000    0000    0000    0000    0000\n          4  \\0  \\0  \\0  \\0  \\0  \\0  \\0  \\0  \\0  \\0  \\0  \\0  \\0  \\0  \\0\n0000100    0000    0000    0000    0000    0000    0000    0000    0000\n         \\0  \\0  \\0  \\0  \\0  \\0  \\0  \\0  \\0  \\0  \\0  \\0  \\0  \\0  \\0  \\0\n")])])]),s("p",[t._v("При выполнении команды "),s("strong",[t._v("lastlog")]),t._v(" на некоторых компьютерах в определенных случаях может возникнуть впечатление, что команда «зависла». Это происходит в силу того, что даже если в системе зарегистрировано всего два пользователя (root и user), в файле /var/log/lastlog все равно отведено место для максимально возможного числа пользователей, которые могут работать в системе. Поэтому в файле /var/log/lastlog могут иметься большие промежутки между номерами идентификаторов работавших в системе пользователей. Поскольку при просмотре таких интервалов программа не выводит информацию на экран, и возникает впечатление «зависания». Потому не спешите нажимать кнопки и закрывать консоль, а дождитесь ответа команды.")]),t._v(" "),s("p",[t._v("Как мы с Вами установили, команда "),s("strong",[t._v("lastlog")]),t._v(" может быть очень полезна для проверки логов тех пользователей, поддержку которых Вы еще осуществляете, чтобы убедиться, что аккаунты в системе используются должным образом и они все еще актуальны. Также не забывайте проверять размер логов, а то может оказаться, что их объем уже значительно превышает общий размер Вашей системы.")]),t._v(" "),s("p",[t._v("Не пренебрегайте в своей работе применять довольно простые команды, и, естественно, используйте место с умом. Удачи!")])])}),[],!1,null,null,null);s.default=v.exports}}]);