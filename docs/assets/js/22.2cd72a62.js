(window.webpackJsonp=window.webpackJsonp||[]).push([[22],{291:function(e,t,a){"use strict";a.r(t);var n=a(14),r=Object(n.a)({},(function(){var e=this,t=e._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[t("p",[e._v("https://anwarvic.github.io/cross-lingual-lm/mT5")]),e._v(" "),t("h1",{attrs:{id:"mt5-multilingual-t5"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#mt5-multilingual-t5"}},[e._v("#")]),e._v(" mT5: Multilingual T5")]),e._v(" "),t("p",[e._v("mT5 stands for “Multilingual Text-to-Text Transfer Transformer” which is a multilingual variant of "),t("a",{attrs:{href:"https://anwarvic.github.io/language-modeling/T5",target:"_blank",rel:"noopener noreferrer"}},[e._v("T5"),t("OutboundLink")],1),e._v(" trained on 101 languages. mT5 was proposed by Google Research in 2020 and published in their paper: "),t("a",{attrs:{href:"https://arxiv.org/pdf/2010.11934.pdf",target:"_blank",rel:"noopener noreferrer"}},[e._v("mT5: A Massively Multilingual Pre-trained Text-to-Text Transformer"),t("OutboundLink")],1),e._v(". The official code can be found on Google Research’s official GitHub repository: "),t("a",{attrs:{href:"https://github.com/google-research/multilingual-t5",target:"_blank",rel:"noopener noreferrer"}},[e._v("google-research/multilingual-t5"),t("OutboundLink")],1),e._v(".")]),e._v(" "),t("p",[e._v("The goal behind this paper and mT5 is to produce a massively multilingual model that deviates as little as possible from the recipe used to create T5. So, they based mT5 on the “"),t("a",{attrs:{href:"https://github.com/google-research/text-to-text-transfer-transformer/blob/master/released_checkpoints.md#t511",target:"_blank",rel:"noopener noreferrer"}},[e._v("T5.1.1"),t("OutboundLink")],1),e._v("” checkpoint which improves upon T5 architecture by using:")]),e._v(" "),t("ul",[t("li",[t("p",[e._v("GeGLU non-linearities instead of ReLU.")])]),e._v(" "),t("li",[t("p",[e._v("Scaling both dmodel�model and dff�ff instead of just dff�ff in the larger models.")])]),e._v(" "),t("li",[t("p",[e._v("No dropout with pre-training.")]),e._v(" "),t("p",[e._v("To put mT5 into perspective, the following table provides a brief comparison with existing cross-lingual language models such as: mBERT, "),t("a",{attrs:{href:"https://anwarvic.github.io/language-modeling/XLM",target:"_blank",rel:"noopener noreferrer"}},[e._v("XLM"),t("OutboundLink")],1),e._v(", "),t("a",{attrs:{href:"https://anwarvic.github.io/language-modeling/XLM-R",target:"_blank",rel:"noopener noreferrer"}},[e._v("XLM-R"),t("OutboundLink")],1),e._v(", and "),t("a",{attrs:{href:"https://anwarvic.github.io/language-modeling/MARGE",target:"_blank",rel:"noopener noreferrer"}},[e._v("MARGE"),t("OutboundLink")],1),e._v(":")])])]),e._v(" "),t("p",[t("img",{attrs:{src:"https://anwarvic.github.io/cross-lingual-lm/media/mT5/image1.png",alt:""}})]),e._v(" "),t("blockquote",[t("p",[t("strong",[e._v("Note to reader:")]),t("br"),e._v("\nBefore getting deeper into this post, I suggest reading the "),t("a",{attrs:{href:"https://anwarvic.github.io/language-modeling/T5",target:"_blank",rel:"noopener noreferrer"}},[e._v("T5 post"),t("OutboundLink")],1),e._v(" first. You don’t have to read all of it, just read the "),t("a",{attrs:{href:"https://anwarvic.github.io/language-modeling/T5/#C4",target:"_blank",rel:"noopener noreferrer"}},[e._v("C4"),t("OutboundLink")],1),e._v(" part and the "),t("a",{attrs:{href:"https://anwarvic.github.io/language-modeling/T5/#Baseline",target:"_blank",rel:"noopener noreferrer"}},[e._v("baseline"),t("OutboundLink")],1),e._v(" part.")])]),e._v(" "),t("h2",{attrs:{id:"mc4"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#mc4"}},[e._v("#")]),e._v(" mC4")]),e._v(" "),t("p",[e._v("To train mT5 on that many languages, they introduced a multilingual variant of the "),t("a",{attrs:{href:"https://www.tensorflow.org/datasets/catalog/c4",target:"_blank",rel:"noopener noreferrer"}},[e._v("C4"),t("OutboundLink")],1),e._v(" dataset called mC4. mC4 comprises natural text in 101 languages drawn from the public Common Crawl web scrape.")]),e._v(" "),t("p",[e._v("The C4 (Colossal Clean Crawled Corpus) dataset was explicitly designed to be English only. In contrast, for mC4 they used "),t("a",{attrs:{href:"https://github.com/google/cld3",target:"_blank",rel:"noopener noreferrer"}},[e._v("cld3 tool"),t("OutboundLink")],1),e._v(" to identify over 100 languages. Since some of these languages are relatively scarce on the internet, they made use of all of the 71 monthly web scrapes released so far by "),t("a",{attrs:{href:"http://commoncrawl.org/",target:"_blank",rel:"noopener noreferrer"}},[e._v("Common Crawl"),t("OutboundLink")],1),e._v(".")]),e._v(" "),t("p",[e._v("An important heuristic filtering step in C4 was the removal of lines that did not end in an English terminal punctuation mark. Since many languages do not use English terminal punctuation marks, they instead applied a “line length filter” that requires pages to contain at least three lines of text with 200 or more characters. Other than that, they followed the C4’s filtering steps which are:")]),e._v(" "),t("ul",[t("li",[t("p",[e._v("They discarded any page with fewer than 5 sentences and only retained lines that contained at least 3 words.")])]),e._v(" "),t("li",[t("p",[e._v("They removed any page that contained any word on the “"),t("a",{attrs:{href:"https://github.com/LDNOOBW/List-of-Dirty-Naughty-Obscene-and-Otherwise-Bad-Words",target:"_blank",rel:"noopener noreferrer"}},[e._v("List of Dirty, Naughty, Obscene or Otherwise Bad Words"),t("OutboundLink")],1),e._v("”.")])]),e._v(" "),t("li",[t("p",[e._v("They removed any line with the word JavaScript since it usually indicates an error on the web.")])]),e._v(" "),t("li",[t("p",[e._v("Some pages had placeholder “lorem ipsum” text; they removed any page where the phrase “lorem ipsum” appeared.")])]),e._v(" "),t("li",[t("p",[e._v("Some pages inadvertently contained code. Since the curly bracket “{“ appears in many programming languages (such as Javascript, widely used on the web) but not in natural text, they removed any pages that contained a curly bracket.")])]),e._v(" "),t("li",[t("p",[e._v("To de-duplicate the dataset, they discarded all but one of any three-sentence span occurring more than once in the data set.")])]),e._v(" "),t("li",[t("p",[e._v("They detected each page’s primary language using "),t("a",{attrs:{href:"https://github.com/google/cld3",target:"_blank",rel:"noopener noreferrer"}},[e._v("cld3 tool"),t("OutboundLink")],1),e._v(" and removed those with a confidence below 70%.")]),e._v(" "),t("p",[e._v("After these filters are applied, they grouped the remaining pages by language and included in the corpus all languages with 10,000 or more pages. This produces text in 101 language as shown in the following figure which shows a histogram of the page counts for each language:")])])]),e._v(" "),t("p",[t("img",{attrs:{src:"https://anwarvic.github.io/cross-lingual-lm/media/mT5/image2.png",alt:""}})]),e._v(" "),t("blockquote",[t("p",[t("strong",[e._v("Note:")]),t("br"),e._v("\nThe previous histogram shows 107 languages as detected by cld3; and that’s because it handles the script variants of the same spoken language. For example, "),t("strong",[e._v("ru")]),e._v(" is Russian in Cyrillic script and "),t("strong",[e._v("ru-Latn")]),e._v(" is Russian in Latin script. Same applies for Japanese (ja), Hindi (hi), Greek (el), Chinese (zh), and Bulgarian (bg).")])]),e._v(" "),t("h2",{attrs:{id:"pre-training-details"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#pre-training-details"}},[e._v("#")]),e._v(" Pre-Training Details")]),e._v(" "),t("p",[e._v("Following the original T5 recipe, they considered five model sizes in their experiments: "),t("strong",[e._v("mT5-Small (≈ 300M parameters)")]),e._v(", "),t("strong",[e._v("mT5-Base (580M)")]),e._v(", "),t("strong",[e._v("mT5-Large (1.2B)")]),e._v(", "),t("strong",[e._v("mT5-XL (3.7B)")]),e._v(", and "),t("strong",[e._v("mT5-XXL (13B)")]),e._v(". The increase in parameter counts compared to the corresponding T5 model variants comes from the larger vocabulary used in mT5.")]),e._v(" "),t("blockquote",[t("p",[t("strong",[e._v("Note:")]),t("br"),e._v("\nBecause mT5 is an encoder-decoder model, it has roughly twice as many parameters as correspondingly-sized encoder-only models such as XLM-R. For example, the “XLM-R~Large~” has 550 million parameters whereas mT5-Large has around 1 billion.")])]),e._v(" "),t("p",[e._v("All mT5 variants were pre-trained for 1 million steps on batches of 1024 input sequences, corresponding to roughly 1 trillion input tokens total. This is the same amount of pre-training as T5 and about 1/6 as much as XLM-R. They used the same inverse square-root learning rate schedule used by T5 during pre-training, with the learning rate set to 1√max(n,k)1max(�,�) where n� is the current training iteration and k=104�=104 is the number of warm-up steps.")]),e._v(" "),t("p",[e._v("Following the "),t("a",{attrs:{href:"https://github.com/google-research/text-to-text-transfer-transformer/blob/master/released_checkpoints.md#t511",target:"_blank",rel:"noopener noreferrer"}},[e._v("T5.1.1"),t("OutboundLink")],1),e._v(" recipe, they didn’t apply dropout during pre-training. They used the same self-supervised objective as T5, with 15%15% of tokens masked and an average noise span length of 33.")]),e._v(" "),t("h3",{attrs:{id:"sampling"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#sampling"}},[e._v("#")]),e._v(" Sampling")]),e._v(" "),t("p",[e._v("A major factor in pre-training multilingual models is how to sample data from each language. In this paper, they used temperature sampling to boost lower-resource languages by sampling examples according to the probability p(L)∝|L|α�(�)∝|�|�, where p(L)�(�) is the probability of sampling text from a given language L� during pre-training and |L||�| is the number of examples in the language. The hyper-parameter α� (typically with α<1�<1) controls how much to “boost” the probability of training on low-resource languages.")]),e._v(" "),t("p",[e._v("Values used by prior work include α=0.7�=0.7 for mBERT, α=0.3�=0.3 for XLM-R, and α=0.2�=0.2 for M4. They tried all three of these values and found α=0.3�=0.3 to give a reasonable compromise between performance on high- and low-resource languages.")]),e._v(" "),t("h3",{attrs:{id:"vocabulary"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#vocabulary"}},[e._v("#")]),e._v(" Vocabulary")]),e._v(" "),t("p",[e._v("The fact that mT5 model covers over 100 languages necessitates a larger vocabulary. Following "),t("a",{attrs:{href:"https://anwarvic.github.io/language-modeling/XLM-R",target:"_blank",rel:"noopener noreferrer"}},[e._v("XLM-R"),t("OutboundLink")],1),e._v(", they increased the vocabulary size to 250,000 wordpieces. As in T5, they used SentencePiece model trained with the language sampling rates used during pre-training. To accommodate languages with large character sets like Chinese, they used a character coverage of 0.999990.99999 and enable SentencePiece’s “byte-fallback” feature to ensure that any string can be uniquely encoded.")]),e._v(" "),t("h2",{attrs:{id:"fine-tuning"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#fine-tuning"}},[e._v("#")]),e._v(" Fine-tuning")]),e._v(" "),t("p",[e._v("To validate the performance of mT5, they evaluated it on 6 tasks from the XTREME multilingual benchmark:")]),e._v(" "),t("ul",[t("li",[t("p",[e._v("The XNLI entailment task covering 14 languages.")])]),e._v(" "),t("li",[t("p",[e._v("The XQuAD reading comprehension covering 10 languages.")])]),e._v(" "),t("li",[t("p",[e._v("The MLQA reading comprehension covering 7 languages.")])]),e._v(" "),t("li",[t("p",[e._v("The TyDi QA reading comprehension covering11 languages.")])]),e._v(" "),t("li",[t("p",[e._v("The Named Entity Recognition (NER) dataset of WikiAnn covering 40 languages.")])]),e._v(" "),t("li",[t("p",[e._v("The PAWS-X paraphrase identification dataset covering 7 languages.")])])]),e._v(" "),t("p",[e._v("All tasks are casted into the text-to-text format. For example, if there are multiple NER entities, then they are concatenated in the order they appear, and if there are no entities then the target text is “None”.")]),e._v(" "),t("p",[e._v("For fine-tuning, they used a constant learning rate of 0.0010.001 and dropout rate of 0.10.1 for all tasks. They used a batch size of 217217 for most tasks but increased this up to 220220 in a few cases based on performance on the validation set. For early stopping, they saved checkpoints every 200200 steps and choose the checkpoint with the highest validation performance.")]),e._v(" "),t("p",[e._v("Regarding fine-tuning, they considered three variants:")]),e._v(" "),t("ul",[t("li",[t("strong",[e._v("Zero-shot:")]),e._v(" where the model is fine-tuned only on English data. The following table shows that mT5-XXL achieves state of the art results")])]),e._v(" "),t("p",[t("img",{attrs:{src:"https://anwarvic.github.io/cross-lingual-lm/media/mT5/image3.png",alt:""}})]),e._v(" "),t("ul",[t("li",[t("strong",[e._v("translate-train:")]),e._v(" adding machine translations from English into each target language.")])]),e._v(" "),t("p",[t("img",{attrs:{src:"https://anwarvic.github.io/cross-lingual-lm/media/mT5/image4.png",alt:""}})]),e._v(" "),t("ul",[t("li",[t("strong",[e._v("in-language multi-task:")]),e._v(" training on gold data in all target languages:")])]),e._v(" "),t("p",[t("img",{attrs:{src:"https://anwarvic.github.io/cross-lingual-lm/media/mT5/image5.png",alt:""}})]),e._v(" "),t("p",[e._v("From the past results we can see that the model capacity is key to improving performance on variants of the TyDi QA GoldP task in the absence of “gold” multilingual data: For the smallest model, training on gold datasets (in-language multitask) achieves dramatically better performance than using weakly supervised data (translate-train) or English-only data (zero-shot), whereas the gap between these three settings is much smaller for the largest model. The following figure points that out clearly as it shows the average F1 on the TyDi QA GoldP task across languages:")]),e._v(" "),t("p",[t("img",{attrs:{src:"https://anwarvic.github.io/cross-lingual-lm/media/mT5/image6.png",alt:""}})]),e._v(" "),t("h2",{attrs:{id:"accidental-translation"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#accidental-translation"}},[e._v("#")]),e._v(" Accidental Translation")]),e._v(" "),t("p",[e._v("Accidental translation is a problematic behavior with the mT5 model in the zero-shot setting where the model start translating part or all of the masked span into English (the language of all fine-tuning data). On the one hand, it is remarkable that mT5 performs “spontaneous” translation despite never seeing parallel training data. On the other, it led to hurting the performance. This problem happens across all model sizes and all XQuAD languages, but happens more in mT5-Small and mT5-Base.")]),e._v(" "),t("p",[e._v("The researchers believe that the reason behind that is that the model has never observed a non-English target during fine-tuning. To fix that, they decided to use a technique called “Domain Preserving Training (DPT)” which is to mix a unsupervised task with fine-tuning.")]),e._v(" "),t("p",[e._v("The unsupervised task they planned to use was the same as the mC4 task definition as in pre-training, with just two adjustments:")]),e._v(" "),t("ul",[t("li",[t("p",[e._v("First, they removed all “sentinel” tokens from the target sequence.")])]),e._v(" "),t("li",[t("p",[e._v("Second, they reduced the language sampling parameter α� from 0.30.3 to 0.10.1. This produces a near uniform distribution of languages, encouraging the model to treat all languages as equally likely.")])])]),e._v(" "),t("p",[e._v("Then, they mixed a small amount of the unsupervised task (covering 101 languages) into XQuAD fine-tuning, at a ratio of just 1:1001:100. The following figure shows the results on XQuAD zero-shot error rates. The addition of this small amount of multilingual data has a marked effect on the mT5- Small and mT5-Base models reducing the illegal prediction rates by more than 7070 (relative), and contributing to an overall reduction in errors:")]),e._v(" "),t("p",[t("img",{attrs:{src:"https://anwarvic.github.io/cross-lingual-lm/media/mT5/image7.png",alt:""}})])])}),[],!1,null,null,null);t.default=r.exports}}]);