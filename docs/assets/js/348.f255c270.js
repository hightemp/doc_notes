(window.webpackJsonp=window.webpackJsonp||[]).push([[348],{620:function(t,s,n){"use strict";n.r(s);var a=n(14),e=Object(a.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("p",[t._v("https://github.com/svinota/pyroute2")]),t._v(" "),s("p",[t._v("Pyroute2 — это чистая библиотека "),s("strong",[t._v("сетевых ссылок")]),t._v(" Python . Для ядра требуется только стандартная библиотека Python, никаких сторонних библиотек. Библиотека была запущена как реализация протокола RTNL, поэтому имя — "),s("strong",[t._v("pyroute2")]),t._v(" , но теперь она поддерживает множество протоколов netlink. Некоторые поддерживаемые семейства и протоколы netlink:")]),t._v(" "),s("ul",[s("li",[s("strong",[t._v("rtnl")]),t._v(" , сетевые настройки --- адреса, маршруты, управление трафиком")]),t._v(" "),s("li",[s("strong",[t._v("nfnetlink")]),t._v(" --- API сетевого фильтра")]),t._v(" "),s("li",[s("strong",[t._v("ipq")]),t._v(" --- простейшая фильтрация пакетов пользовательского пространства, цель iptables QUEUE")]),t._v(" "),s("li",[s("strong",[t._v("devlink")]),t._v(" --- управление и мониторинг оборудования с поддержкой devlink")]),t._v(" "),s("li",[s("strong",[t._v("generic")]),t._v(" --- общие семейства netlink")]),t._v(" "),s("li",[s("strong",[t._v("uevent")]),t._v(" --- те же сообщения uevent, что и в udev")])]),t._v(" "),s("p",[t._v("API сетевого фильтра:")]),t._v(" "),s("ul",[s("li",[s("strong",[t._v("ipset")]),t._v(" --- наборы IP")]),t._v(" "),s("li",[s("strong",[t._v("nftables")]),t._v(" --- фильтрация пакетов")]),t._v(" "),s("li",[s("strong",[t._v("nfct")]),t._v(" --- отслеживание соединения")])]),t._v(" "),s("p",[t._v("Общая сетевая ссылка:")]),t._v(" "),s("ul",[s("li",[s("strong",[t._v("ethtool")]),t._v(" --- низкоуровневая настройка сетевого интерфейса")]),t._v(" "),s("li",[s("strong",[t._v("wireguard")]),t._v(" --- настройка VPN")]),t._v(" "),s("li",[s("strong",[t._v("nl80211")]),t._v(" --- API беспроводных функций (базовая поддержка)")]),t._v(" "),s("li",[s("strong",[t._v("taskstats")]),t._v(" --- расширенная статистика процесса")]),t._v(" "),s("li",[s("strong",[t._v("acpi_events")]),t._v(" --- мониторинг событий ACPI")]),t._v(" "),s("li",[s("strong",[t._v("Thermal_events")]),t._v(" --- мониторинг тепловых событий")]),t._v(" "),s("li",[s("strong",[t._v("VFS_DQUOT")]),t._v(" --- мониторинг событий дисковой квоты")])]),t._v(" "),s("p",[t._v("На низком уровне библиотека предоставляет объекты сокетов с расширенным API. Дополнительный функционал направлен на:")]),t._v(" "),s("ul",[s("li",[t._v("Помогите открыть/привязать сокеты netlink")]),t._v(" "),s("li",[t._v("Откройте для себя общие протоколы netlink и группы многоадресной рассылки")]),t._v(" "),s("li",[t._v("Создание, кодирование и декодирование сообщений netlink и PF_ROUTE.")])]),t._v(" "),s("h2",{attrs:{id:"поддерживаемые-системы"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#поддерживаемые-системы"}},[t._v("#")]),t._v(" Поддерживаемые системы")]),t._v(" "),s("p",[t._v("Pyroute2 изначально работает в Linux и эмулирует некоторое ограниченное подмножество RTNL netlink API в системах BSD поверх уведомлений PF_ROUTE и стандартных системных инструментов.")]),t._v(" "),s("p",[t._v("Другие платформы не поддерживаются.")]),t._v(" "),s("h2",{attrs:{id:"ndb-высокоуровневыи-api-rtnl"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ndb-высокоуровневыи-api-rtnl"}},[t._v("#")]),t._v(" "),s("a",{attrs:{href:"https://github.com/svinota/pyroute2#ndb----high-level-rtnl-api",target:"_blank",rel:"noopener noreferrer"}},[s("OutboundLink")],1),t._v("NDB -- высокоуровневый API RTNL")]),t._v(" "),s("p",[t._v("Ключевая особенность:")]),t._v(" "),s("ul",[s("li",[t._v("Целостность данных")]),t._v(" "),s("li",[t._v("Транзакции с фиксацией/откатом изменений")]),t._v(" "),s("li",[t._v("Синхронизация состояний")]),t._v(" "),s("li",[t._v("Несколько источников, включая netns и удаленные системы")])]),t._v(" "),s("p",[t._v('Пример "Привет, мир":')]),t._v(" "),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" pyroute2 "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" NDB\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("with")]),t._v(" NDB"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("as")]),t._v(" ndb"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("with")]),t._v(" ndb"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("interfaces"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'eth0'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("as")]),t._v(" eth0\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# set one parameter")]),t._v("\n        eth0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("set")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("state"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'down'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        eth0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("commit"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# make sure that the interface is down")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# or multiple parameters at once")]),t._v("\n        eth0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("set")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ifname"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'hello_world!'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" state"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'up'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        eth0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("commit"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# rename, bring up and wait for success")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# --\x3e <-- here you can be sure that the interface is up & renamed")]),t._v("\n")])])]),s("p",[t._v("Еще примеры:")]),t._v(" "),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" pyroute2 "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" NDB\n\nndb "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" NDB"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("log"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'debug'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" record "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" ndb"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("interfaces"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("summary"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("print")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("record"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ifname"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" record"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("address"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" record"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("state"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\nif_dump "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" ndb"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("interfaces"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("dump"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nif_dump"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("select_records"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("state"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'up'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nif_dump"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("select_fields"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'index'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'ifname'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'kind'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" line "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" if_dump"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("format")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'json'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("print")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("line"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\naddr_summary "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" nsb"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("addresses"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("summary"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\naddr_summary"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("select_records"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ifname"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'eth0'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" line "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" addr_summary"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("format")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'csv'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("print")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("line"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("with")]),t._v(" ndb"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("interfaces"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("create"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ifname"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'br0'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" kind"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'bridge'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("as")]),t._v(" br0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    br0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("add_port"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'eth0'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    br0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("add_port"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'eth1'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    br0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("add_ip"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'10.0.0.1/24'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    br0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("add_ip"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'192.168.0.1/24'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    br0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("set")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n        br_stp_state"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# set STP on")]),t._v("\n        br_group_fwd_mask"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0x4000")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# set LLDP forwarding")]),t._v("\n        state"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'up'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# bring the interface up")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# --\x3e <-- commit() will be run by the context manager")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# operate on netns:")]),t._v("\nndb"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("sources"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("add"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("netns"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'testns'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# connect to a namespace")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("with")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n    ndb"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("interfaces"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("create"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n        ifname"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'veth0'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# create veth")]),t._v("\n        kind"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'veth'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        peer"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'ifname'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'eth0'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# setup peer")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'net_ns_fd'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'testns'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# in a namespace")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        state"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'up'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("as")]),t._v(" veth0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    veth0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("add_ip"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("address"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'172.16.230.1'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" prefixlen"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("24")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("with")]),t._v(" ndb"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("interfaces"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("wait"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n    target"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'testns'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" ifname"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'eth0'")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("as")]),t._v(" peer"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# wait for the peer")]),t._v("\n    peer"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("set")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("state"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'up'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# bring it up")]),t._v("\n    peer"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("add_ip"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'172.16.230.2/24'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# add address")]),t._v("\n")])])]),s("h2",{attrs:{id:"iproute-низкоуровневыи-rtnl-api"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#iproute-низкоуровневыи-rtnl-api"}},[t._v("#")]),t._v(" "),s("a",{attrs:{href:"https://github.com/svinota/pyroute2#iproute----low-level-rtnl-api",target:"_blank",rel:"noopener noreferrer"}},[s("OutboundLink")],1),t._v("IPRoute -- низкоуровневый RTNL API")]),t._v(" "),s("p",[t._v("Низкоуровневая утилита "),s("strong",[t._v("IPRoute")]),t._v(" --- конфигурация сети Linux. Класс IPRoute представляет собой сопоставление RTNL 1-к-1 "),s("strong",[t._v(".")]),t._v(" Нет неявного поиска интерфейса и так далее.")]),t._v(" "),s("p",[t._v("Получайте уведомления об изменении сетевых настроек с помощью IPRoute:")]),t._v(" "),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" pyroute2 "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" IPRoute\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("with")]),t._v(" IPRoute"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("as")]),t._v(" ipr"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# With IPRoute objects you have to call bind() manually")]),t._v("\n    ipr"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("bind"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" message "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" ipr"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("get"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("print")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("message"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("p",[t._v("Еще примеры:")]),t._v(" "),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" socket "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" AF_INET\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" pyroute2 "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" IPRoute\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# get access to the netlink socket")]),t._v("\nipr "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" IPRoute"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# no monitoring here -- thus no bind()")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# print interfaces")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" link "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" ipr"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("get_links"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("print")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("link"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# create VETH pair and move v0p1 to netns 'test'")]),t._v("\nipr"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("link"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'add'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" ifname"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'v0p0'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" peer"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'v0p1'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" kind"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'veth'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# wait for the devices:")]),t._v("\npeer"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" veth "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" ipr"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("poll"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n    ipr"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("link"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'dump'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" timeout"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" ifname"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("lambda")]),t._v(" x"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" x "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'v0p0'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'v0p1'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nipr"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("link"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'set'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" index"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("peer"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'index'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" net_ns_fd"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'test'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# bring v0p0 up and add an address")]),t._v("\nipr"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("link"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'set'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" index"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("veth"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'index'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" state"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'up'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nipr"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("addr"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'add'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" index"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("veth"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'index'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" address"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'10.0.0.1'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" prefixlen"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("24")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# release Netlink socket")]),t._v("\nip"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("close"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("h2",{attrs:{id:"примеры-сетевых-пространств-имен"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#примеры-сетевых-пространств-имен"}},[t._v("#")]),t._v(" "),s("a",{attrs:{href:"https://github.com/svinota/pyroute2#network-namespace-examples",target:"_blank",rel:"noopener noreferrer"}},[s("OutboundLink")],1),t._v("Примеры сетевых пространств имен")]),t._v(" "),s("p",[t._v("Манипуляции с сетевым пространством имен:")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("from pyroute2 import netns\n# create netns\nnetns.create('test')\n# list\nprint(netns.listnetns())\n# remove netns\nnetns.remove('test')\n")])])]),s("p",[t._v("Создайте пару интерфейсов "),s("strong",[t._v("veth")]),t._v(" и перейдите к "),s("strong",[t._v("netns")]),t._v(" :")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("from pyroute2 import IPRoute\n\nwith IPRoute() as ipr:\n\n    # create interface pair\n    ipr.link('add', ifname='v0p0', kind='veth',  peer='v0p1')\n\n    # wait for the peer\n    (peer,) = ipr.poll(ipr.link, 'dump', timeout=5, ifname='v0p1')\n\n    # move the peer to the 'test' netns:\n    ipr.link('set', index=peer['index'], net_ns_fd='test')\n")])])]),s("p",[t._v("Список интерфейсов в некоторых "),s("strong",[t._v("netns")]),t._v(" :")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("from pyroute2 import NetNS\nfrom pprint import pprint\n\nns = NetNS('test')\npprint(ns.get_links())\nns.close()\n")])])]),s("p",[t._v("Подробнее и примеры смотрите в документации.")]),t._v(" "),s("h2",{attrs:{id:"монтаж"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#монтаж"}},[t._v("#")]),t._v(" "),s("a",{attrs:{href:"https://github.com/svinota/pyroute2#installation",target:"_blank",rel:"noopener noreferrer"}},[s("OutboundLink")],1),t._v("Монтаж")]),t._v(" "),s("p",[t._v("Использование pip:")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("pip install pyroute2\n")])])]),s("p",[t._v("Использование git:")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("pip install git+https://github.com/svinota/pyroute2.git\n")])])]),s("p",[t._v("Использование источника требует make и nox")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("git clone https://github.com/svinota/pyroute2.git\ncd pyroute2\nmake install\n")])])]),s("h2",{attrs:{id:"требования"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#требования"}},[t._v("#")]),t._v(" "),s("a",{attrs:{href:"https://github.com/svinota/pyroute2#requirements",target:"_blank",rel:"noopener noreferrer"}},[s("OutboundLink")],1),t._v("Требования")]),t._v(" "),s("p",[t._v("Питон >= 3.6")]),t._v(" "),s("h2",{attrs:{id:"ссылки"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ссылки"}},[t._v("#")]),t._v(" "),s("a",{attrs:{href:"https://github.com/svinota/pyroute2#links",target:"_blank",rel:"noopener noreferrer"}},[s("OutboundLink")],1),t._v("Ссылки")]),t._v(" "),s("ul",[s("li",[t._v("домашняя страница: "),s("a",{attrs:{href:"https://pyroute2.org/",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://pyroute2.org/"),s("OutboundLink")],1)]),t._v(" "),s("li",[t._v("источник: "),s("a",{attrs:{href:"https://github.com/svinota/pyroute2",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://github.com/svinota/pyroute2"),s("OutboundLink")],1)]),t._v(" "),s("li",[t._v("ошибки: "),s("a",{attrs:{href:"https://github.com/svinota/pyroute2/issues",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://github.com/svinota/pyroute2/issues"),s("OutboundLink")],1)]),t._v(" "),s("li",[t._v("Пипи: "),s("a",{attrs:{href:"https://pypi.python.org/pypi/pyroute2",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://pypi.python.org/pypi/pyroute2"),s("OutboundLink")],1)]),t._v(" "),s("li",[t._v("документы: "),s("a",{attrs:{href:"http://docs.pyroute2.org/",target:"_blank",rel:"noopener noreferrer"}},[t._v("http://docs.pyroute2.org/"),s("OutboundLink")],1)])])])}),[],!1,null,null,null);s.default=e.exports}}]);